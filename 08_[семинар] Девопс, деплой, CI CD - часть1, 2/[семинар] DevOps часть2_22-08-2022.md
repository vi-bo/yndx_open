## Deploy —á–∞—Å—Ç—å 2.

–ü–µ—Ä–≤–æ–∏—Å—Ç–æ—á–Ω–∏–∫: [–î–µ–≤–æ–ø—Å, –¥–µ–ø–ª–æ–π, CI/CD. –ß–∞—Å—Ç—å 2 - YouTube](https://www.youtube.com/watch?v=5cbvqmDAOZA)

–í —á–∞—Å—Ç–∏ 1.  –º—ã —É–∂–µ –Ω–∞—á–∞–ª–∏ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –Ω–∞—à–∏ –¥–≤–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ java –∏ –Ω–∞ python.  –ö–æ–¥ –ø—Ä–∏–º–µ—Ä–æ–≤ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ [GitHub - grigory51/shbr-devops](https://github.com/grigory51/shbr-devops). 

> **–ü–û–õ–ï–ó–ù–´–ï –ö–û–ú–ê–ù–î–´:**
> 
> `vagrant up` # –∑–∞–ø—É—Å–∫ vagrnt
> 
> `vagrant ssh` # –∑–∞–π—Ç–∏ –≤ –º–∞—à–∏–Ω—É
> 
> `minikube start --driver=none` # –∑–∞–ø—É—Å–∫ minikube
> 
> `kubectl get –°–£–©–ù–û–°–¢–¨` # –ø–µ—Ä–µ—á–µ–Ω—å namespaces, pods, services –∏ —Ç.–¥. 
> 
> `kubectl create namespace –ò–ú–Ø` # —Å–æ–∑–¥–∞–Ω–∏–µ namespaces
> 
> `kubectl -n shbr apply -f –ò–ú–Ø__deployment.yaml` # –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ò–ú–Ø__deployment (+ Pods —Å–æ–∑–¥–∞—é—Ç—Å—è), –≤ —Ñ–∞–π–ª–µ –ò–ú–Ø__deployment.yaml –∑–∞–¥–∞–µ—Ç—Å—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
> 
> `kubectl -n shbr apply -f –ò–ú–Ø_service.yaml` # –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ò–ú–Ø_service (–¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ—Ä—Ç–æ–≤, –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª–µ –ò–ú–Ø_service.yaml, –¥–ª—è –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º)
> 
> `kubectl -n –ò–ú–Ø_namespaces get pods` # –ø–µ—Ä–µ—á–µ–Ω—å Pod –≤ –ò–ú–Ø_namespaces
> 
> `kubectl -n shbr delete pod –ò–ú–Ø_pod` # —É–¥–∞–ª–µ–Ω–∏–µ Pod
> 
> `watch -n 0.5 kubectl -n shbr get pod` # –≤—ã–≤–æ–¥ –≤ —Ü–∏–∫–ª–µ
> 
> `vagrant halt` # –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã

### 5. –£—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤

 –ö–∞–∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —É–ø–æ—Ç—Ä–µ–±–∏—Ç—å –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã –∏ –¥–µ–Ω—å–≥–∏ –±—ã–ª–∏ –ø–æ—Ç—Ä–∞—á–µ–Ω—ã –Ω–µ –∑—Ä—è?

#### Bare-metal

–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º —É –Ω–∞—Å —Ç—Ä–∏ –æ–¥–µ–ª–∞, –∫–∞–∂–¥—ã–π –∏–∑ –æ—Ç–¥–µ–ª–æ–≤ –∏–º–µ–µ—Ç –ø–æ —Ç—Ä–∏ —Å–µ—Ä–≤–µ—Ä–∞ –∑–∞ 1 –º–ª–Ω.—Ä—É–±. –ö–∞–∂–¥–∞—è —à–∫–æ–ª–∞ –∑–∞–¥–µ–ø–ª–æ–∏–ª–∞ –ø–æ –æ–¥–Ω–æ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é. –ú–∞—à–∏–Ω—ã –Ω–µ–¥–æ—É—Ç–∏–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã.

<img src="file:///home/vibo/Pictures/GlobalMarkText/2022-08-17-19-43-10-image.png" title="" alt="" data-align="center">

1. –ù–∞ –æ–¥–Ω–æ–º –∂–µ–ª–µ–∑–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ –∑–∞–ø—É—â–µ–Ω—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã/–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç-–æ—Ç–¥–µ–ª–∞.

2. –í —Å–ª—É—á–∞–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–∫–µ—Ç–æ–≤, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –æ–±—â–µ–º —Å–ª—É—á–∞ –Ω–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞, –∫–æ–Ω–∫—É—Ä–∏—Ä—É—é—Ç –∑–∞ —Ä–µ—Å—É—Ä—Å—ã.

3. –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —É—Ç–∏–ª–∏–∑–∞—Ü–∏—è - –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º —Ä–µ—Å—É—Ä—Å–∞–º (–æ–¥–∏–Ω –æ—Ç–¥–µ–ª –Ω–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∂–µ–ª–µ–∑–Ω—ã–º –º–∞—à–∏–Ω–∞–º –¥—Ä—É–≥–æ–≥–æ –æ—Ç–¥–µ–ª–∞).

**CAPEX (–∫–∞–ø–∏—Ç–∞–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã)** - –∫–∞–ø–∏—Ç–∞–ª, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π—Å—è –∫–æ–º–ø–∞–Ω–∏—è–º–∏ –¥–ª—è –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏—è –∏–ª–∏ –º–æ–¥–µ—Ä–Ω–∏–∑–∞—Ü–∏–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –∞–∫—Ç–∏–≤–æ–≤ (—Å—é–¥–∞ –≤—Ö–æ–¥—è—Ç –∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∂–µ–ª–µ–∑–∞). –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ –≤—Å–µ —Å—Ç—Ä–µ–º—è—Ç—Å—è —ç—Ç–∏ —Ä–∞—Å—Ö–æ–¥—ã –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –∏ –Ω–µ –ø–æ–∫—É–ø–∏—Ç—å –Ω–æ–≤–æ–µ –∂–µ–ª–µ–∑–æ.

–ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤—Å–µ –∂–µ–ª–µ–∑–Ω—ã–µ –º–∞—à–∏–Ω—ã –≤ –µ–¥–∏–Ω—ã–π –ø—É–ª —Å–µ—Ä–≤–µ—Ä–æ–≤ –∏ –¥–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∏–º–∏ –≤—Å–µ–º –æ—Ç–¥–µ–ª–∞–º.

<img src="file:///home/vibo/Pictures/GlobalMarkText/2022-08-17-20-14-19-image.png" title="" alt="" data-align="center">

–í—Å–µ –º–∞—à–∏–Ω—ã –Ω–∞–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ —É—Ç–∏–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã. –û—Ä–≥–∞–Ω–∏—á–µ–Ω–∏—è –∫–æ–º—É —Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∑–∞–ø—É—Å–∫–∞—Ç—å —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –ø—É—Ç–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏—è –∫–≤–æ—Ç, –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ. –ï—Å—Ç—å –æ—Ç–¥–µ–ª, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–∞–∫ —Å–µ—Ä–≤–∏—Å - –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

**–û–±–ª–∞–∫–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:**

1. –ù–∞ –æ–¥–Ω–æ–º –∂–µ–ª–µ–∑–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ –∑–∞–ø—É—â–µ–Ω–æ –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ä–∞–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

2. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞, –∏–º–µ—é—Ç –≥–∞—Ä–∞–Ω—Ç–∏–∏ –Ω–∞ —Ä–µ—Å—É—Ä—Å—ã

3. –ú–∞—Å–∫–∏–º–∞–ª—å–Ω–∞—è —É—Ç–∏–ª–∏–∑–∞—Ü–∏—è

### 6. –°–∏—Å—Ç–µ–º—ã –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏

–ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã —Ä–æ–±–æ—Ç—ã —Ä–∞–±–æ—Ç–∞–ª–∏ –∑–∞ –Ω–∞—Å?

–ß—Ç–æ–±—ã —Ä–∞—Å–∫–ª–∞–¥—ã–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ –Ω–∞—à–∏–º —Å–µ—Ä–≤–µ—Ä–∞–º, —Ç.–∫. —ç—Ç–æ —Ç–µ–ø–µ—Ä—å —è–≤–ª—è–µ—Ç—Å—è –µ–¥–∏–Ω—ã–º –ø–ª–æ—Å–∫–∏–º —Å–ø–∏—Å–∫–æ–º, –∫–æ—Ç–æ—Ä—ã–π –¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–º –∏ –º—ã —Ç–µ–ø–µ—Ä—å –Ω–µ –∑–Ω–∞–µ–º –≥–¥–µ —Ç–µ–ø–µ—Ä—å –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ, –∏ –Ω–∞–º –≤—Ü–µ–ª–æ–º —ç—Ç–æ –Ω–µ –≤–∞–∂–Ω–æ, —á—Ç–æ–±—ã —ç—Ç–æ –ø—Ä–æ–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏.

**–ß–µ–ª–æ–≤–µ–∫** - —Å–∞–º–∞—è –ø—Ä–æ—Å—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –≤ —Ä—É—á–Ω–æ–º —Ä–µ–∂–∏–º–µ —Å–∏–¥–µ—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç–µ–º, –∫–∞–∫–µ –¥–æ–∫–µ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ –≥–¥–µ –∑–∞–ø—É—â–µ–Ω—ã.

–ü–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ ansible, –∫–∞–∫ —ç—Ç–æ –º–æ–≥–ª–æ –±—ã –≤—ã–≥–ª—è–¥–µ—Ç—å.

#### Ansible: —Ñ–∞–π–ª inventory

–í ansible –µ—Å—Ç—å —Å—É–ø–µ—Ä –≤–∞–∂–Ω—ã–π —Ñ–∞–π–ª - inventory,  –≤ –∫–æ—Ç–æ—Ä–æ–º –µ—Å—Ç—å —Å–ø–∏—Å–æ–∫ —Ö–æ—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–º–∏ –º—ã —É–ø—Ä–∞–≤–ª—è–µ–º. –°–æ–æ—Ç–≤–µ—Ç—Å–≤–µ–Ω–æ —Ö–æ—Å—Ç–∞–º –º–æ–∂–Ω–æ –Ω–∞–∑–Ω–∞—á–∞—Ç—å —Ä–æ–ª–∏, —Ç.–µ. –∫–∞–∫–∏–º-—Ç–æ –º–∞—à–∏–Ω–∞–º –º—ã –Ω–∞–∑–Ω–∞—á–∏–ª–∏ —Ä–æ–ª—å  hadoop_nodes, –¥—Ä—É–≥–∏–º app_nodes.

```
[hadoop_nodes]
srv-1
srv-2
srv-3

[app_nodes]
srv-4
srv-5
srv-6
```

–°–æ–æ—Ç–≤–µ—Ç—Å–≤–µ–Ω–Ω–æ –≤ —Ä—É—á–Ω–æ–º —Ä–µ–∂–∏–º–µ  –º—ã –º–æ–∂–µ–º –Ω–∞–±–ª—é–¥–∞—Ç—å, —á—Ç–æ —Ç—Ä–∞—Ñ–∏–∫ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —É–≤–µ–ª–∏—á–∏–ª—Å—è –∏ —á–∞—Å—Ç—å –º–∞—à–∏–Ω –º—ã –ø–µ—Ä–µ–∫–∏–¥—ã–≤–∞–µ–º –≤ –¥—Ä—É–≥—É—é –≥—Ä—É–ø–ø—É –∏ —Ä–∞—Å–∫–∞—Ç—ã–≤–∞–µ–º –Ω–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é.

```
[hadoop_nodes]
srv-1

[app_nodes]
srv-2¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†# –ø–µ—Ä–µ–Ω–µ—Å–ª–∏ –ø—Ä–∏ —Ä–æ—Å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
srv-3¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†# –ø–µ—Ä–µ–Ω–µ—Å–ª–∏ –ø—Ä–∏ —Ä–æ—Å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
srv-4
srv-5
srv-6
```

–ù–∞—Å—Ç—É–ø–∏–ª–∞ –Ω–æ—á—å, –≥–æ—Ä–æ–¥ –∑–∞—Å—ã–ø–∞–µ—Ç, —Ç—Ä–∞—Ñ–∏–∫ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–Ω–∏–∂–∞–µ—Ç—Å—è. –•–æ—Ç–∏–º –ø–æ—Å—á–∏—Ç–∞—Ç—å —Ñ–æ–Ω–æ–≤—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ–∏–∑–æ—à–ª–∞ –∑–∞ –¥–µ–Ω—å.  –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—é —É–∂–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –º–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å–æ–≤, —Ä–µ—Å—É—Ä—Å—ã –≤–æ—Å–≤–æ–±–æ–¥–∏–ª–∏—Å—å –∏ –º—ã –º–æ–∂–µ–º –ø–æ—Å—á–∏—Ç–∞—Ç—å –≤—Å—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.

```
[hadoop_nodes]
srv-1
srv-2¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†# –≤–µ—Ä–Ω—É–ª–∏ –ø—Ä–∏ —Å–Ω–∏–∂–µ–Ω–∏–∏ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ¬†¬†¬†¬†¬†¬†
srv-3¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†# –≤–µ—Ä–Ω—É–ª–∏ –ø—Ä–∏ —Å–Ω–∏–∂–µ–Ω–∏–∏ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
srv-4¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†# –ø–µ—Ä–µ–Ω–µ—Å–ª–∏ –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
srv-5¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†# –ø–µ—Ä–µ–Ω–µ—Å–ª–∏ –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

[app_nodes]
srv-6
```

–¢–∞–∫–æ–π —Å–ø–æ—Å–æ–± —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π, —Ç–æ–ø–æ—Ä–Ω—ã–π, –Ω–æ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ.

–°–ª–µ–¥—É—é—â–∞—è —Å–∏—Å—Ç–µ–º–∞, –ø–æ –Ω–∞—Ä–æ—Å—Ç–∞–Ω–∏—é —Å–ª–æ–∂–æ—Å—Ç–∏ —ç—Ç–æ Docker SWARM

#### Docker SWARM

<img title="" src="file:///home/vibo/Pictures/GlobalMarkText/2022-08-19-10-18-11-image.png" alt="" data-align="center">

–õ–æ–≥–∏–∫–∞ —Å–ª–µ–¥—É—é—â–∞—è, –µ—Å—Ç—å –Ω–µ–∫–∏–π –º–∞—Å—Ç–µ—Ä –º–µ–Ω–µ–¥–∂–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –∑–Ω–∞–µ—Ç –æ –≤—Å–µ—Ö –Ω–∞—à–∏—Ö –º–∞—à–∏–Ω–∞—Ö. –í –µ–≥–æ –ø–∞–º—è—Ç–∏ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ñ–∞–π–ª–∏–∫ inventory (–∫–∞–∫ –≤ —Å—Ö–µ–º–∞—Ö –≤ —Ä–∞–∑–¥–µ–ª–µ –≤—ã—à–µ) –∏ –æ–Ω –º–æ–∂–µ—Ç –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –º–∞—à–∏–Ω–∞–º –∏ —Ä–∞–∑–¥–∞–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã. –ó–Ω–∞—è –≤—Å–µ –º–∞—à–∏–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ —É –Ω–µ–≥–æ –µ—Å—Ç—å –æ–Ω –∏–º–∏ –æ–ø–µ—Ä–∏—Ä—É–µ—Ç –∏ —Ä–∞–∑–¥–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –≥–¥–µ –∫–∞–∫–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–¥–Ω—è—Ç—å.

–ß—Ç–æ–±—ã —ç—Ç–æ –ø–æ–∫–∞–∑–∞—Ç—å —Ä–∞–±–æ—Ç—É Docker SWARM –º—ã –≤–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è VirtualBox, –≤ —á–∞—Å—Ç–Ω–æ—Å—Ç–∏ –µ–≥–æ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º Vagrant.

##### VirtualBox + Vagrant

`cd 05-orchestration-swarm`

Vagrantfile –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –∫–æ–¥ –Ω–∞ Ruby, –∑–¥–µ—Å—å –º—ã –º–æ–∂–µ–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω, –º–æ–∂–µ–º —Å–æ–±—Ä–∞—Ç—å –æ—Ä–∫–µ—Å—Ç—Ä. –û–ø–∏—Å—ã–≤–∞–µ–º –Ω–µ–∫–∏–π –º–∞–Ω–∏—Ñ–µ—Å—Ç –Ω–∞ Ruby.

```ruby
Vagrant.configure("2") do |config|
  config.vm.box_check_update = false
  config.vbguest.installer_options = { allow_kernel_upgrade: true } # vagrant plugin install vagrant-vbguest

  #vibo: —Ö–æ—Ç–∏–º –ø–æ–¥–Ω—è—Ç—å —Ç—Ä–∏ –º–∞—à–∏–Ω—ã
  (1..3).each do |i| #vibo: –ø–∏—à–µ–º —Ü–∏–∫–ª
    config.vm.define "node-#{i}" do |node|
      node.vm.box = "ubuntu/focal64" #vibo: –ø–µ—Ä–≤–∞—è –º–∞—à–∏–Ω–∞ master-swarm
      node.vm.hostname = "node-#{i}" #vibo: —Ä–∞–±–æ—á–∏–π nod1
      node.vagrant.host = "node-#{i}" #vibo: —Ä–∞–±–æ—á–∏–π nod2

      #vibo: –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä—É–µ–º, —á—Ç–æ–±—ã —É –Ω–∏—Ö –±—ã–ª–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ ip-–∞–¥—Ä–µ—Å–∞
      #vibo: –ø—Ä–æ–±—Ä–æ—Å–∏—Ç—å –ø–æ—Ä—Ç—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –Ω–∞–∑–Ω–∞—á–∏—Ç—å –∏–º–µ–Ω–∞
      node.vm.network "private_network", ip: "10.0.0.#{i+1}", virtualbox__intnet: "swarm"
      node.vm.network "forwarded_port", guest: 9090 + i, host: 9090 + i, host_ip: '127.0.0.1', protocol: 'tcp', auto_correct: true

      node.vm.provider "virtualbox" do |v|
        v.name = "node-#{i}"
      end

      #vibo: —Ç–∞–∫–∂–µ Vagrant –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ä–∞–∑—É –Ω–∞–∫–∞—Ç—ã–≤–∞—Ç—å –Ω—É–∂–Ω—ã–µ –Ω–∞–º –ø–∞–∫–µ—Ç—ã
      #vibo: c –ø–æ–º–æ—â—å—é —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ provision, —Å—É—â–µ—Å—Ç–≤—É—é—Ç —Ä–∞–∑–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã
      #vibo: —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —ç—Ç–æ shell
      node.vm.provision "shell" do |s|
        s.inline = <<-SHELL
          #vibo: –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –º—ã –ø–æ–¥–Ω–∏–º–µ–º VirtualBox –≤–∏—Ä—Ç—É–∞–ª–∫—É, –≤–Ω—É—Ç—Ä–∏
          #vibo: –∏–∑ –Ω–∏—Ö –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –∫–æ–¥, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –¥–æ–∫–µ—Ä
          set -e
          apt-get update
          apt-get install -y apt-transport-https ca-certificates curl gnupg-agent software-properties-common

          curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add -
          add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"

          apt-get update
          apt-get install -y docker-ce docker-ce-cli docker-compose containerd.io
          systemctl enable docker
          systemctl start docker
          usermod -a -G docker vagrant
        SHELL
        s.privileged = true
      end
    end
  end
end
```

> –∑–¥–µ—Å—å –±—ã–ª–∏ –º–Ω–æ–≥–æ—á–∞—Å–æ–≤—ã–µ —Ç–∞–Ω—Ü—ã —Å –±—É–±–Ω–∞–º–∏ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏ 404, –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ vagrant up

`vagrant up` # –∑–∞–ø—É—Å–∫–∞–µ–º –º–∞—à–∏–Ω—ã

–ü—Ä–æ—Ü–µ—Å—Å —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–µ–±—ã—Å—Ç—Ä—ã–π, –ø–æ—Å–ª–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞:

```bash
Bringing machine 'node-1' up with 'virtualbox' provider...
Bringing machine 'node-2' up with 'virtualbox' provider...
Bringing machine 'node-3' up with 'virtualbox' provider...
==> node-1: Machine already provisioned. Run `vagrant provision` or use the `--provision`
==> node-1: flag to force provisioning. Provisioners marked to run always will still run.
==> node-2: Machine already provisioned. Run `vagrant provision` or use the `--provision`
==> node-2: flag to force provisioning. Provisioners marked to run always will still run.
==> node-3: Machine already provisioned. Run `vagrant provision` or use the `--provision`
==> node-3: flag to force provisioning. Provisioners marked to run always will still run.
```

–ò—Ç–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–ª–µ–¥—É—é—â–∞—è: –Ω–∞ –æ–¥–Ω–æ–π –º–∞—à–∏–Ω–µ –∑–∞–ø—É—â–µ–Ω master Docker SWARM, –Ω–∞ –¥–≤—É—Ö –¥—Ä—É–≥–∏—Ö –º–∞—à–∏–Ω–∞—Ö –∑–∞–ø—É—â–µ–Ω—ã —Ä–∞–±–æ—á–∏–µ node. –ü–æ—Å–ª–µ –∑–∞–ø–∫—É—Å–∫–∞ –º–∞—à–∏–Ω —Å–ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ provision –Ω–∞ –º–∞—à–∏–Ω–∞—Ö —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –¥–æ–∫–µ—Ä.

`lsl node-1` # –∑–∞—Ö–æ–¥–∏–º –Ω–∞ –º–∞—à–∏–Ω—É 1 (–≤ –¢–µ—Ä–º–∏–Ω–∞–ª–µ 1)

`vagrant ssh node-2` # –∑–∞—Ö–æ–¥–∏–º –Ω–∞ –º–∞—à–∏–Ω—É 2 (–≤ –¢–µ—Ä–º–∏–Ω–∞–ª–µ 2)

`vagrant ssh node-3` # –∑–∞—Ö–æ–¥–∏–º –Ω–∞ –º–∞—à–∏–Ω—É 3 (–≤ –¢–µ—Ä–º–∏–Ω–∞–ª–µ 3)

–ß—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Ç–µ—Ä Docker SWARM –µ–≥–æ –Ω—É–∂–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥–æ–π –Ω–∞ –º–∞—Å—Ç–µ—Ä (node-1), 10.0.0.2 - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –∫–æ—Ç–æ—Ä—ã–π —Ç–æ—Ä—á–∏—Ç –Ω–∞—Ä—É–∂—É, —á—Ç–æ–±—ã –Ω–∞—à–∏ –Ω–æ–¥—ã –º–æ–≥–ª–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –º–∞—Å—Ç–µ—Ä—É (—ç—Ç–æ—Ç –∞–¥—Ä–µ—Å –ø—Ä–æ–ø–∏—Å–∞–Ω –≤ —É—Å—Ç–∞–Ω–æ–≤–æ—á–Ω–æ–º vagrant-—Ñ–∞–π–ª–µ):

`docker swarm init --advertise-addr 10.0.0.2` # –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Docker SWARM

```bash
Swarm initialized: current node (6eymyddx2k9vvnrahk174q2sh) is now a manager.

To add a worker to this swarm, run the following command:

    docker swarm join --token SWMTKN-1-37e06ru2uvpzstxdyy2z60jobvjtaeptpc6e0iag069nk5grpt-80q1itgfw8ecsp58kfecbo01e 10.0.0.2:2377

To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.
```

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã –¥–∞–µ—Ç—Å—è –ø–æ–¥—Å–∫–∞–∑–∫–∞ –æ —Ç–æ–º, —á—Ç–æ–±—ã –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å –º–∞—à–∏–Ω—ã –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É docker swarm join, —É–∫–∞–∑–∞—Ç—å –∏–Ω–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏ —É–∫–∞–∑–∞—Ç—å —Ö–æ—Å—Ç, –≥–¥–µ –∑–∞–ø—É—â–µ–Ω –º–∞—Å—Ç–µ—Ä, ip-–∞–¥—Ä–µ—Å –∏ –ø–æ—Ä—Ç:

`docker swarm join --token SWMTKN-1-37e06ru2uvpzstxdyy2z60jobvjtaeptpc6e0iag069nk5grpt-80q1itgfw8ecsp58kfecbo01e 10.0.0.2:2377` # –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ–º node-1, node-2 (–≤ –¢–µ—Ä–º–∏–Ω–∞–ª–µ 2 –∏ 3)

```bash
This node joined a swarm as a worker.
```

–ù–æ–¥—ã —Å–æ–æ–±—â–∞—é—Ç, —á—Ç–æ –æ–Ω–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –∫ swarm –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ä–∞–±–æ—á–∏—Ö –Ω–æ–¥. –í—ã–æ–¥–∏–º –ø–µ—Ä–µ—á–µ–Ω—å –Ω–æ–¥:

`docker node ls` # –≤—ã–≤–æ–¥ –ø–µ—Ä–µ—á–Ω—è node

```bash
ID                            HOSTNAME   STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION
6eymyddx2k9vvnrahk174q2sh *   node-1     Ready     Active         Leader           20.10.17
pb1jol2nftf7s4ig8rev1r54p     node-2     Ready     Active                          20.10.17
odhsw92copboelilp4r9miz2t     node-3     Ready     Active                          20.10.17
```

–í–∏–¥–∏–º, —á—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å —Ç—Ä–∏ —Ä–∞–±–æ—á–∏–µ node, –æ–¥–Ω–∞ –∏–∑ –Ω–∏—Ö –ª–∏–¥–µ—Ä. –ó–∞–ø—É—Å—Ç–∏–º —Å–µ—Ä–≤–∏—Å –Ω–∞ –Ω–∞—à–µ–º –∫–ª–∞—Å—Ç–µ—Ä–µ:

`docker service create --replicas 3 --name shbr-echo cr.yandex/crpamim8dasm0u97qtpf/shbr-01-package-docker:latest`

–ö–æ–º–∞–Ω–¥–∞ –ø–æ—Ö–æ–∂–∞ –Ω–∞ docker-run, —Ç–æ–ª—å–∫–æ –≤–º–µ—Å—Ç–æ run –∑–¥–µ—Å—å service create, —Ç–∞–∫–∂–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç–∞–Ω—Å–µ–≤ –Ω–∞–º –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å (--replicas 3). –£–∫–∞–∑—ã–≤–∞–µ–º 3, —á—Ç–æ–±—ã –Ω–∞ –∫–∞–∂–¥–æ–π –Ω–æ–¥–µ –∑–∞–ø–∫—Å—Ç–∏–ª–æ—Å—å –ø–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é.

```bash
kaic31q83rz6w1poifdn6hdkp
overall progress: 3 out of 3 tasks 
1/3: running   
2/3: running   
3/3: running   
verify: Service converged 
```

–í—ã–¥–∏–º, —á—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–µ–Ω, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ node-2, node-3, –º—ã –Ω–∞ –Ω–∏—Ö –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–ª–∏, –Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ—è–≤–∏–ª–æ—Å—å:

`docker ps` #  –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ 2 (node-2)

```bash
vagrant@node-2:~$ docker ps
CONTAINER ID   IMAGE                                                          COMMAND            CREATED         STATUS         PORTS       NAMES
aa995e231c64   cr.yandex/crpamim8dasm0u97qtpf/shbr-01-package-docker:latest   "/entrypoint.sh"   3 minutes ago   Up 3 minutes   10000/tcp   shbr-echo.3.0f4yhk07lvkcs2dgnxfm6isit
```

`docker ps` # –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ 3 (node-3)

```bash
vagrant@node-3:~$ docker ps
CONTAINER ID   IMAGE                                                          COMMAND            CREATED         STATUS         PORTS       NAMES
42e36ff0a2ca   cr.yandex/crpamim8dasm0u97qtpf/shbr-01-package-docker:latest   "/entrypoint.sh"   4 minutes ago   Up 4 minutes   10000/tcp   shbr-echo.1.36p3m2b7j5k9s614peuykswfo
```

–°–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–∏—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –ø–æ–¥–Ω–∏–º–∞–ª–∏ –º–æ–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥–æ–π:

`docker service list` # —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
vagrant@node-1:~$ docker service list
ID             NAME        MODE         REPLICAS   IMAGE                                                          PORTS
kaic31q83rz6   shbr-echo   replicated   3/3        cr.yandex/crpamim8dasm0u97qtpf/shbr-01-package-docker:latest   
```

–ó–¥–µ—Å—å –≤–∏–¥–∏–º, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ shbr-echo –∑–∞–ø—É—â–µ–Ω–æ –≤ 3/3 —ç–∫–∑–µ–º–ø–ª—è—Ä–∞—Ö.

–ï—Å–ª–∏ —Ö–æ—Ç–∏–º –æ—Ç–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–∏—Å–∫–ª—é—á–∏—Ç—å —Å –æ–¥–Ω–æ–π –º–∞—à–∏–Ω—ã):

`docker service scale shbr-echo=2` # –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
vagrant@node-1:~$ docker service scale shbr-echo=2
shbr-echo scaled to 2
overall progress: 2 out of 2 tasks 
1/2: running   [==================================================>] 
2/2: running   [==================================================>] 
verify: Service converged
```

–ö–æ–º–∞–Ω–¥–æ–π `docker ps` –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏ –≤–∏–¥–∏–º, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ—Ç –Ω–∞ node-2. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å:

`docker service update --publish-add target=10000,published=10000 shbr-echo`

<img src="file:///home/vibo/Pictures/GlobalMarkText/2022-08-23-00-06-14-image.png" title="" alt="" data-align="center">

–¢–µ–ø–µ—Ä—å, —Å–º–æ–∂–µ–º –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –Ω–∞—à–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º:

`curl http://localhost:10000/hello`

```
hello
```

–ü—Ä–∏ —ç—Ç–æ–º –Ω–µ —Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ –Ω–∞ node-3 –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ—Ç, –æ—Ç–≤–µ—Ç –º—ã –ø–æ–ª—É—á–∞–µ–º.

```bash
vagrant@node-3:~$ docker ps
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES

vagrant@node-3:~$ curl http://localhost:10000/hello
hello
```

–ü–æ—Å–ª–µ–¥–Ω–∏–π –ø—Ä–∏–º–µ—Ä —Å Docker SWARM, –¥–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:

`docker service update --env-add PREFIX="World, " shbr-echo`

```bash
shbr-echo
overall progress: 2 out of 2 tasks 
1/2: running   
2/2: running   
verify: Service converged 
```

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª–∏—Å—å. –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–æ–µ—Ö–∞–ª–∞ –¥–æ –Ω–∞—à–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –∏ –≤ –æ—Ç–≤–µ—Ç–µ –æ–Ω–∞ —Ç–µ–ø–µ—Ä—å –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç:

`curl http://localhost:10000/hello`

```bash
World, hello
```

–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã –∫–æ–º–∞–Ω–¥–æ–π:

`exit` # –≤—ã—Ö–æ–¥–∏–º –∏–∑ –º–∞—à–∏–Ω—ã

`vagrant halt` # –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã

```
==> node-3: Attempting graceful shutdown of VM...
==> node-2: Attempting graceful shutdown of VM...
==> node-1: Attempting graceful shutdown of VM...
```

Docker SWARM - –¥–∞–≤–Ω—è—è –∏—Å—Ç–æ—Ä–∏—è, —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∞, –ø—Ä–æ—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –ø—Ä–æ—Å—Ç–æ–π –ø–æ–¥—Ö–æ–¥. –ù–∞ —Å–º–µ–Ω—É Docker SWARM –ø—Ä–∏—à–µ–ª **kubernetes**.

#### kubernetes

–≠—Ç–æ –±–æ–ª–µ–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∏ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è, –ø—Ä–∏—à–ª–∞ –Ω–∞ —Å–º–µ–Ω—É Docker SWARM. –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è —Å—Ç–∞–ª–∞ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º –≤ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏. –ï—Å—Ç—å –∏ –¥—Ä—É–≥–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –Ω–æ —Å–µ–π—á–∞—Å —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –µ–≥–æ.

##### –°—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞—è —Å—Ö–µ–º–∞

![](/home/vibo/Pictures/GlobalMarkText/2022-08-23-00-07-27-image.png)

–ï—Å—Ç—å master, –≤ –Ω–µ–º - api server –∫ –∫–æ—Ç–æ—Ä–æ–º—É –º—ã –æ–±—Ä–∞—â–∞–µ–º—Å—è. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, –∫–æ–≥–¥–∞ –æ–±—Ä–∞—â–∞–µ–º—Å—è –∫ —ç—Ç–æ–º—É api server –≥–æ–≤–æ—Ä–∏–º, —á—Ç–æ –Ω–∞–º –Ω—É–∂–µ–Ω –∑–∞–¥–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤ —Ç—Ä–µ—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–∞—Ö. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —ç—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö - stcd (database). –î–∞–ª–µ–µ –º–∞—Å—Ç–µ—Ä –ø—ã—Ç–∞–µ—Ç—Å—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –≤ –∑–∞–¥–∞–Ω–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏. –¢.–µ. –µ—Å–ª–∏ –º—ã —Å–∫–∞–∑–∞–ª–∏, —á—Ç–æ –Ω–∞–º –Ω—É–∂–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —Ç—Ä–µ—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–∞—Ö, –∞ –∫–∞–∫–æ–π-—Ç–æ –∏–∑ —Å–µ—Ä–≤–µ—Ä–æ–≤ –≤—ã–∫–ª—é—á–∏–ª—Å—è - —Ç–æ –º–∞—Å—Ç–µ—Ä —Å–∞–º –ø–æ–π–º–µ—Ç, —á—Ç–æ –≤–º–µ—Å—Ç–æ —Ç—Ä–µ—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç –¥–≤–∞ –∏ –Ω—É–∂–Ω–æ —Å—Ä–æ—á–Ω–æ –Ω–∞–π—Ç–∏ –Ω–æ–≤—É—é –Ω–æ–¥—É, –∫—É–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–º–µ–Ω—É –ø—Ä–æ–ø–∞–≤—à–µ–º—É —Å–µ—Ä–≤–µ—Ä—É. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –∫–æ–º–ø–æ–Ω–µ—Ç –º–∞—Å—Ç—Ä–∞ - controllers –∏ scheduler. –≠—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–ª–µ–¥—è—Ç –∑–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç –∫–æ–º–∞–Ω–¥—ã –ø–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º—É —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é –∏ –ø—ã—Ç–∞—é—Ç—Å—è —Ä–∞—Å–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ–±—ã –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω—è–ª–∏—Å—å –∑–∞ –ø—Ä–∏–µ–º–ª–µ–º–æ–µ –≤—Ä–µ–º—è. –ï—Å—Ç—å —Ä–∞–∑–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–∞—Å—Ç–µ—Ä–∞, —Å–æ 100% –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º. –°–µ–π—á–∞—Å —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º –ø—Ä–æ—Å—Ç—É—é —Å—Ö–µ–º—É. –¢–∞–∫–∂–µ –µ—Å—Ç—å node - —ç—Ç–æ –Ω–µ–∫–∏–µ "—Ä–∞–±–æ—á–∏–µ –ª–æ—à–∞–¥–∫–∏", –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã kubelet –∏ kube-proxy. kubelet - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –æ—Ç api server –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ –ø–æ–¥–Ω—è—Ç–∏—è—é, –æ–ø—É—Å–∫–∞–Ω–∏—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤; kube-proxy - –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Ç—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ –Ω–æ–¥–µ.

##### –û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏

- **Pod** - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –µ–¥–∏–Ω–∏—Ü–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è, –≥—Ä—É–ø–ø–∞ –∏–∑ –æ–¥–Ω–æ–≥–æ –∏–ª–∏ –±–æ–ª–µ–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è –Ω–∞ –Ω–æ–¥–µ (—Ç.–µ. –æ–¥–∏–Ω Pod –º—ã –Ω–µ –º–æ–∂–µ–º —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –Ω–∞ –¥–≤—É—Ö —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö, —ç—Ç–æ —á—Ç–æ-—Ç–æ –Ω–µ–¥–µ–ª–∏–º–æ–µ; –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ Pod –µ—Å—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –ø–æ–¥–Ω—è—Ç—å –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —ç—Ç–∏—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤).

- **Deployment** - –æ–±—ä–µ–∫—Ç –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤—Ä–Ω–æ-–æ–ø–∏—Å—ã–≤–∞—é—â–∏–π Pod—ã, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–ø–ª–∏–∫ –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∏—Ö –∑–∞–º–µ–Ω—ã –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (—à–∞–±–ª–æ–Ω Poda –∏ –∫–∞–∫ –µ–≥–æ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å, –µ—Å–ª–∏ –∫–∞–∫–æ–π-—Ç–æ Pod —É–ø–∞–¥–µ—Ç - Deployment –ø–æ–¥–Ω–∏–º–µ–Ω—Ç –∑–∞–º–µ–Ω—É). 

- **Service** - –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å–µ—Ç–µ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞, –≤ —Ç–æ–º —á–∏—Å–ª–µ —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É –Ω–∞–≥—Ä—É–∑–∫–∏ –º–µ–∂–¥—É Pod–∞–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—ç—Ç–æ –¥–µ–∫–ª–∞—Ä–∞—Ü–∏—è - –ø—É–±–ª–∏–∫—É–µ–º –∫–æ–Ω—Ü—ã –Ω–∞—Ä—É–∂—É).

`cd 05-orchestration-k8s`

`vagrant up` # –∑–∞–ø—É—Å–∫–∞–µ–º vagrant (–∏–ª–∏ —Ç–∞–Ω—Ü—ã —Å –±—É–±–Ω–æ–º –∏–ª–∏ —á–µ—Ä–µ–∑ vpn —Å —Ö–æ–¥—É)

```bash
Bringing machine 'minikube' up with 'virtualbox' provider...
==> minikube: Machine already provisioned. Run `vagrant provision` or use the `--provision`
==> minikube: flag to force provisioning. Provisioners marked to run always will still run.
```

`vagrant ssh`

```bash
Welcome to Ubuntu 20.04.4 LTS (GNU/Linux 5.4.0-124-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Mon Aug 22 21:40:39 UTC 2022

  System load:  0.1               Processes:                133
  Usage of /:   6.3% of 38.70GB   Users logged in:          0
  Memory usage: 13%               IPv4 address for docker0: 172.17.0.1
  Swap usage:   0%                IPv4 address for enp0s3:  10.0.2.15


3 updates can be applied immediately.
2 of these updates are standard security updates.
To see these additional updates run: apt list --upgradable

New release '22.04.1 LTS' available.
Run 'do-release-upgrade' to upgrade to it.
```

`cd /vagrant/` # –ø–µ—Ä–µ–º–µ—â–∞–µ–º—Å—è –≤ –ø–∞–ø–∫—É –∏–∑ –∫–æ—Ç–æ—Ä–æ–π –∑–∞–ø—É—Å–∫–∞–ª–∏ vagrant

`ls`

```bash
Vagrantfile  hint.sh  k8s
```

##### minikube

–ß—Ç–æ–±—ã –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å kubernetes –ª–æ–∫–∞–ª—å–Ω–æ –º–æ–∂–Ω–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–æ–º–∞–Ω–¥–æ–π minikube - —ç—Ç–æ –Ω–µ–∫–∞—è –∫–æ–Ω—Å–æ–ª—å–Ω–∞—è —É—Ç–∏–ª–∏—Ç–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞ —Å–≤–æ–µ–º –Ω–æ—É—Ç–±—É–∫–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π kubernetes

`minikube start --driver=none`

```bash
üòÑ  minikube v1.23.2 on Ubuntu 20.04 (vbox/amd64)
‚ú®  Using the none driver based on user configuration

üßØ  The requested memory allocation of 2200MiB does not leave room for system overhead (total system memory: 2484MiB). You may face stability issues.
üí°  Suggestion: Start minikube with less memory allocated: 'minikube start --memory=2200mb'

üëç  Starting control plane node minikube in cluster minikube
ü§π  Running on localhost (CPUs=2, Memory=2484MB, Disk=39630MB) ...
‚ÑπÔ∏è  OS release is Ubuntu 20.04.4 LTS
üê≥  Preparing Kubernetes v1.22.2 on Docker 20.10.17 ...
    ‚ñ™ kubelet.resolv-conf=/run/systemd/resolve/resolv.conf
üéâ  minikube 1.26.1 is available! Download it: https://github.com/kubernetes/minikube/releases/tag/v1.26.1
üí°  To disable this notice, run: 'minikube config set WantUpdateNotification false'

    > kubectl.sha256: 64 B / 64 B [--------------------------] 100.00% ? p/s 0s
    > kubeadm.sha256: 64 B / 64 B [--------------------------] 100.00% ? p/s 0s
    > kubelet.sha256: 64 B / 64 B [--------------------------] 100.00% ? p/s 0s
    > kubectl: 44.73 MiB / 44.73 MiB [---------------] 100.00% 2.57 MiB p/s 18s
    > kubeadm: 43.71 MiB / 43.71 MiB [---------------] 100.00% 2.33 MiB p/s 19s
    > kubelet: 146.25 MiB / 146.25 MiB [-------------] 100.00% 3.55 MiB p/s 41s
    ‚ñ™ Generating certificates and keys ...
    ‚ñ™ Booting up control plane ...
    ‚ñ™ Configuring RBAC rules ...
ü§π  Configuring local host environment ...

‚ùó  The 'none' driver is designed for experts who need to integrate with an existing VM
üí°  Most users should use the newer 'docker' driver instead, which does not require root!
üìò  For more information, see: https://minikube.sigs.k8s.io/docs/reference/drivers/none/

‚ùó  kubectl and minikube configuration will be stored in /home/vagrant
‚ùó  To use kubectl or minikube commands as your own user, you may need to relocate them. For example, to overwrite your own settings, run:

    ‚ñ™ sudo mv /home/vagrant/.kube /home/vagrant/.minikube $HOME
    ‚ñ™ sudo chown -R $USER $HOME/.kube $HOME/.minikube

üí°  This can also be done automatically by setting the env var CHANGE_MINIKUBE_NONE_USER=true
üîé  Verifying Kubernetes components...
    ‚ñ™ Using image gcr.io/k8s-minikube/storage-provisioner:v5
üåü  Enabled addons: default-storageclass, storage-provisioner

‚ùó  /snap/bin/kubectl is version 1.24.4, which may have incompatibilites with Kubernetes 1.22.2.
    ‚ñ™ Want kubectl v1.22.2? Try 'minikube kubectl -- get pods -A'
üèÑ  Done! kubectl is now configured to use "minikube" cluster and "default" namespace by default
```

–í—Å–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏–ª–æ—Å—å, —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –Ω–∞—à–µ–º—É kubernetes –∫–ª–∞—Å—Ç–µ—Ä—É. –î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞ kubectl.

`kubectl get namespaces`

```bash
NAME              STATUS   AGE
default           Active   65s
kube-node-lease   Active   66s
kube-public       Active   66s
kube-system       Active   66s
```

`kubectl get namespaces -o yaml` # –≤ yaml —Ñ–æ—Ä–º–∞—Ç–µ

```yaml
apiVersion: v1
items:
- apiVersion: v1
  kind: Namespace
  metadata:
    creationTimestamp: "2022-08-22T21:49:47Z"
    labels:
      kubernetes.io/metadata.name: default
    name: default
    resourceVersion: "206"
    uid: 3c4f3cd6-3433-4993-87f1-c5d510b3167a
  spec:
    finalizers:
    - kubernetes
  status:
    phase: Active
- apiVersion: v1
  kind: Namespace
  metadata:
    creationTimestamp: "2022-08-22T21:49:46Z"
    labels:
      kubernetes.io/metadata.name: kube-node-lease
    name: kube-node-lease
    resourceVersion: "43"
    uid: 7c360004-c01c-47ff-b2c4-3d1f32689287
  spec:
    finalizers:
    - kubernetes
  status:
    phase: Active
- apiVersion: v1
  kind: Namespace
  metadata:
    creationTimestamp: "2022-08-22T21:49:46Z"
    labels:
      kubernetes.io/metadata.name: kube-public
    name: kube-public
    resourceVersion: "40"
    uid: 4557d02d-ca02-45cb-9cff-64c0a73afcd2
  spec:
    finalizers:
    - kubernetes
  status:
    phase: Active
- apiVersion: v1
  kind: Namespace
  metadata:
    creationTimestamp: "2022-08-22T21:49:46Z"
    labels:
      kubernetes.io/metadata.name: kube-system
    name: kube-system
    resourceVersion: "15"
    uid: 6d4f5456-9460-46e4-b4d5-c63cff74f5ad
  spec:
    finalizers:
    - kubernetes
  status:
    phase: Active
kind: List
metadata:
  resourceVersion: ""
```

`kubectl get namespaces -o json` # –≤ json —Ñ–æ—Ä–º–∞—Ç–µ

```json
{
    "apiVersion": "v1",
    "items": [
        {
            "apiVersion": "v1",
            "kind": "Namespace",
            "metadata": {
                "creationTimestamp": "2022-08-22T21:49:47Z",
                "labels": {
                    "kubernetes.io/metadata.name": "default"
                },
                "name": "default",
                "resourceVersion": "206",
                "uid": "3c4f3cd6-3433-4993-87f1-c5d510b3167a"
            },
            "spec": {
                "finalizers": [
                    "kubernetes"
                ]
            },
            "status": {
                "phase": "Active"
            }
        },
        {
            "apiVersion": "v1",
            "kind": "Namespace",
            "metadata": {
                "creationTimestamp": "2022-08-22T21:49:46Z",
                "labels": {
                    "kubernetes.io/metadata.name": "kube-node-lease"
                },
                "name": "kube-node-lease",
                "resourceVersion": "43",
                "uid": "7c360004-c01c-47ff-b2c4-3d1f32689287"
            },
            "spec": {
                "finalizers": [
                    "kubernetes"
                ]
            },
            "status": {
                "phase": "Active"
            }
        },
        {
            "apiVersion": "v1",
            "kind": "Namespace",
            "metadata": {
                "creationTimestamp": "2022-08-22T21:49:46Z",
                "labels": {
                    "kubernetes.io/metadata.name": "kube-public"
                },
                "name": "kube-public",
                "resourceVersion": "40",
                "uid": "4557d02d-ca02-45cb-9cff-64c0a73afcd2"
            },
            "spec": {
                "finalizers": [
                    "kubernetes"
                ]
            },
            "status": {
                "phase": "Active"
            }
        },
        {
            "apiVersion": "v1",
            "kind": "Namespace",
            "metadata": {
                "creationTimestamp": "2022-08-22T21:49:46Z",
                "labels": {
                    "kubernetes.io/metadata.name": "kube-system"
                },
                "name": "kube-system",
                "resourceVersion": "15",
                "uid": "6d4f5456-9460-46e4-b4d5-c63cff74f5ad"
            },
            "spec": {
                "finalizers": [
                    "kubernetes"
                ]
            },
            "status": {
                "phase": "Active"
            }
        }
    ],
    "kind": "List",
    "metadata": {
        "resourceVersion": ""
    }
}
```

##### namespace

–î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã kubernetes —Å–æ–∑–¥–∞–¥–∏–º —Å–≤–æ–π namespace, –≤–Ω—É—Ç—Ä–∏ namespace –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ª—é–±—ã–µ –æ–±—ä–µ–∫—Ç—ã.

`kubectl create namespace shbr`

```
namespace/shbr created
```

–î–∞–ª–µ–µ –≤—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—É, –∫–æ—Ç–æ—Ä–∞—è –≤–Ω—É—Ç—Ä–∏ namespase shbr –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ–∞–π–ª deployment.yaml. –í —ç—Ç–æ–º —Ñ–∞–π–ª–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ - Deployment, —ç—Ç–æ —Ç–∞ —Å—É—â–Ω–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä–∞—è –≤–Ω—É—Ç—Ä–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —à–∞–±–ª–æ–Ω –Ω–∞—à–∏—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º—ã —Ö–æ—Ç–∏–º –∑–∞–ø—É—Å—Ç–∏—Ç—å. –§–∞–π–ª deployment.yaml:

```yaml
apiVersion: apps/v1 # –∏–º—è api
kind: Deployment # –∏–º—è —Å—É—â–Ω–æ—Å—Ç–∏, –æ–±—ä–µ–∫—Ç–∞ kubernetes
metadata: # –º–µ—Ç–∞–¥–∞—Ç–∞, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –≤ –ø—Ä–æ–≥—Ä–∞–º–º—ã–Ω—ã—Ö —Ü–µ–ª—è—Ö
  name: shbr-echo
  labels:
    app: shbr-echo
spec: # –æ–ø–∏—Å–∞–Ω–∏–µ
  replicas: 1 # –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º, –∫–æ—Ç–æ—Ä–æ–µ –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å
  selector:
    matchLabels:
      app: shbr-echo
  template:
    metadata:
      labels:
        app: shbr-echo
    spec:
      containers:
        - image: cr.yandex/crpamim8dasm0u97qtpf/shbr-01-package-docker:latest
          imagePullPolicy: "Always"
          name: shbr-echo # –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
      restartPolicy: Always
```

##### deployment

`cd /vagrant/`

`ls`

```
Vagrantfile   hint.sh   k8s
```

–î–∞–ª–µ–µ –º—ã –¥–æ—Å–ª–æ–≤–Ω–æ –ø—Ä–æ—Å–∏–º –≤–Ω—É—Ç—Ä–∏ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ namespaces - shbr –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∞–π–ª deployment.yaml

`kubectl -n shbr apply -f k8s/deployment.yaml`

Kubectl –æ—Ç–≤–µ—á–∞–µ—Ç, —á—Ç–æ —Ç–∞–∫–æ–π deployment —É—Å–ø–µ—à–Ω–æ —Å–∑–¥–∞–Ω:

```
deployment.apps/shbr-echo created
```

–ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–ø–∏—Å–æ–∫ deployments:

`kubectl -n shbr get deployments`

–í–∏–¥–∏–º, —á—Ç–æ deployments shbr-echo - —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, 1/1 Pod –≥–æ—Ç–æ–≤, –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω–æ.

```bash
NAME        READY   UP-TO-DATE   AVAILABLE   AGE
shbr-echo   1/1     1            1           96s
```

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è delpoyments kubernetes —Å–æ–∑–¥–∞–µ—Ç pod. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ø–∏—Å–æ–∫ Pod:

`kubectl -n shbr get pod`

```bash
NAME                        READY   STATUS    RESTARTS   AGE
shbr-echo-9cf75d6f6-vpmts   1/1     Running   0          5m23s
```

–ú–æ–∂–µ –≤—ã–≤–µ—Å—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ —ç—Ç–æ–º—É Pod –≤ yaml —Ñ–æ—Ä–º–∞—Ç–µ:

`kubectl -n shbr get pod shbr-echo-9cf75d6f6-vpmts -o yaml`

```yaml
apiVersion: v1
kind: Pod
metadata:
  creationTimestamp: "2022-08-22T22:06:10Z"
  generateName: shbr-echo-9cf75d6f6-
  labels:
    app: shbr-echo
    pod-template-hash: 9cf75d6f6
  name: shbr-echo-9cf75d6f6-vpmts
  namespace: shbr
  ownerReferences:
  - apiVersion: apps/v1
    blockOwnerDeletion: true
    controller: true
    kind: ReplicaSet # owner —ç—Ç–æ Poda
    name: shbr-echo-9cf75d6f6 # –∏–º—è owner Poda
    uid: 77f77deb-da3c-4f8f-ade6-2ebab897b169
  resourceVersion: "1188"
  uid: 57c4443f-0df5-43c3-a591-567629bcfe57
spec:
  containers:
  - image: cr.yandex/crpamim8dasm0u97qtpf/shbr-01-package-docker:latest
    imagePullPolicy: Always
    name: shbr-echo
    resources: {}
    terminationMessagePath: /dev/termination-log
    terminationMessagePolicy: File
    volumeMounts:
    - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
      name: kube-api-access-8rvbc
      readOnly: true
  dnsPolicy: ClusterFirst
  enableServiceLinks: true
  nodeName: minikube
  preemptionPolicy: PreemptLowerPriority
  priority: 0
  restartPolicy: Always
  schedulerName: default-scheduler
  securityContext: {}
  serviceAccount: default
  serviceAccountName: default
  terminationGracePeriodSeconds: 30
  tolerations:
  - effect: NoExecute
    key: node.kubernetes.io/not-ready
    operator: Exists
    tolerationSeconds: 300
  - effect: NoExecute
    key: node.kubernetes.io/unreachable
    operator: Exists
    tolerationSeconds: 300
  volumes:
  - name: kube-api-access-8rvbc
    projected:
      defaultMode: 420
      sources:
      - serviceAccountToken:
          expirationSeconds: 3607
          path: token
      - configMap:
          items:
          - key: ca.crt
            path: ca.crt
          name: kube-root-ca.crt
      - downwardAPI:
          items:
          - fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
            path: namespace
status:
  conditions:
  - lastProbeTime: null
    lastTransitionTime: "2022-08-22T22:06:10Z"
    status: "True"
    type: Initialized
  - lastProbeTime: null
    lastTransitionTime: "2022-08-22T22:06:53Z"
    status: "True"
    type: Ready
  - lastProbeTime: null
    lastTransitionTime: "2022-08-22T22:06:53Z"
    status: "True"
    type: ContainersReady
  - lastProbeTime: null
    lastTransitionTime: "2022-08-22T22:06:10Z"
    status: "True"
    type: PodScheduled
  containerStatuses:
  - containerID: docker://f359cefaa759d4d00b1ae0f91ff4b86a5ac005573a79904cba5297edff60c158
    image: cr.yandex/crpamim8dasm0u97qtpf/shbr-01-package-docker:latest
    imageID: docker-pullable://cr.yandex/crpamim8dasm0u97qtpf/shbr-01-package-docker@sha256:ae5bb6451f39f4afb07fd7e0267864b97da092d85eac9ffbdf980fef3aa74022
    lastState: {}
    name: shbr-echo
    ready: true
    restartCount: 0
    started: true
    state:
      running:
        startedAt: "2022-08-22T22:06:52Z"
  hostIP: 10.0.2.15
  phase: Running
  podIP: 172.17.0.3
  podIPs:
  - ip: 172.17.0.3
  qosClass: BestEffort
  startTime: "2022-08-22T22:06:10Z"
```

–ü–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ replicaset:

`kubectl -n shbr get replicaset shbr-echo-9cf75d6f6`

```
NAME                  DESIRED   CURRENT   READY   AGE
shbr-echo-9cf75d6f6   1         1         1       11m
```

`kubectl -n shbr get replicaset shbr-echo-9cf75d6f6 -o yaml`

```yaml
apiVersion: apps/v1
kind: ReplicaSet
metadata:
  annotations:
    deployment.kubernetes.io/desired-replicas: "1"
    deployment.kubernetes.io/max-replicas: "2"
    deployment.kubernetes.io/revision: "1"
  creationTimestamp: "2022-08-22T22:06:10Z"
  generation: 1
  labels:
    app: shbr-echo
    pod-template-hash: 9cf75d6f6
  name: shbr-echo-9cf75d6f6
  namespace: shbr
  ownerReferences:
  - apiVersion: apps/v1
    blockOwnerDeletion: true
    controller: true
    kind: Deployment # owner —ç—Ç–æ–≥–æ ReplicaSet - Deployment, –∫–æ—Ç–æ—Ä—ã–π –º—ã —Å–æ–∑–¥–∞–ª–∏
    name: shbr-echo
    uid: b33fa9c2-45fc-4977-a9ac-f41afa8ac5c6
  resourceVersion: "1189"
  uid: 77f77deb-da3c-4f8f-ade6-2ebab897b169
spec:
  replicas: 1
  selector:
    matchLabels:
      app: shbr-echo
      pod-template-hash: 9cf75d6f6
  template:
    metadata:
      creationTimestamp: null
      labels:
        app: shbr-echo
        pod-template-hash: 9cf75d6f6
    spec:
      containers:
      - image: cr.yandex/crpamim8dasm0u97qtpf/shbr-01-package-docker:latest
        imagePullPolicy: Always
        name: shbr-echo
        resources: {}
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
      dnsPolicy: ClusterFirst
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: {}
      terminationGracePeriodSeconds: 30
status:
  availableReplicas: 1
  fullyLabeledReplicas: 1
  observedGeneration: 1
  readyReplicas: 1
  replicas: 1
```

**–ú—ã —Å–æ–∑–¥–∞–ª–∏ –æ–±—ä–µ–∫—Ç Deployment, –æ–±—ä–µ–∫—Ç Deployment –ø–æ—Ä–æ–¥–∏–ª –æ–±—ä–µ–∫—Ç ReplicaSet, –∞ –æ–±—ä–µ–∫—Ç ReplicaSet –ø–æ—Ä–æ–¥–∏–ª –æ–±—ä–µ–∫—Ç Pod**. –ò –≤–æ—Ç Pod - —ç—Ç–æ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç (–∞—Ç–æ–º) –≤ —Å–∏—Å—Ç–µ–º–µ kubernetes –∏ –∫–æ–≥–¥–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç Pod - –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–ª–ª–æ–∫–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–∞ –æ–¥–Ω–æ–π –∏—Ö –º–∞—à–∏–Ω –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ. –≠—Ç–∏–º –∑–∞–Ω–∏–º–∞—é—Ç—Å—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã, –æ–Ω–∏ –∑–Ω–∞—é—Ç –ø–æ apiVersion –∏ –ø–æ kind, —á—Ç–æ –¥–µ–ª–∞—Ç—å —Å —Ç–µ–º –∏–ª–∏ –∏–Ω—ã–º —Ä–µ—Å—É—Ä—Å–æ–º. –ù–∞—à–∞ –∑–∞–¥–∞—á–∞ –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã, –∞ –∫–æ–Ω—Ç–æ–ª–ª–µ—Ä—ã —ç—Ç–∏ —Ä–µ—Å—É—Ä—Å—ã —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç.

–¢–∞–∫–∂–µ –µ—Å—Ç—å —Ç–∏–ø —Ä–µ—Å—É—Ä—Å–∞ service, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–µ–Ω –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –Ω–∞—à Pod, –∫–æ—Ç—Ä—ã–π –º—ã –ø–æ–¥–Ω—è–ª–∏ –∞–Ω–æ–Ω—Å–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—Ä—É–∂—É, —á—Ç–æ–±—ã –∫ –Ω–µ–º—É –±—ã–ª –¥–æ—Å—Ç—É–ø. –§–∞–π–ª service.yaml:

```yaml
apiVersion: v1
kind: Service
metadata:
  name: shbr-echo
  labels:
    app: shbr-echo
spec:
  type: NodePort
  ports:
  - port: 10000 # –ø–æ—Ä—Ç, –∫–æ—Ç–æ—Ä—ã–π —Å–ª—É—à–∞–µ—Ç –∫–æ–Ω—Ç–µ–Ω–µ—Ä
    nodePort: 32000 # –ø–æ—Ä—Ç –≤–Ω—É—Ç—Ä–∏ —Å–µ—Ä–≤–∏—Å–∞
    protocol: TCP
  selector:
    app: shbr-echo
```

##### service

–ü–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å deployment —Å–æ–∑–¥–∞–¥–∏–º service

`kubectl -n shbr apply -f k8s/service.yaml`

```
service/shbr-echo created
```

`kubectl -n shbr get services`

```bash
NAME        TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)           AGE
shbr-echo   NodePort   10.109.158.125   <none>        10000:32000/TCP   51s
```

–£ –Ω–∞—Å —Å–æ–∑–¥–∞–ª—Å—è —Å–µ—Ä–≤–∏—Å, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π ip —É –Ω–µ–≥–æ 10.109.158.125. –ü–æ—Ä—Ç 10000 - —Ç–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π —Å–ª—É—à–∞–µ—Ç –∫–æ–Ω—Ç–µ–Ω–µ—Ä, –∞ –ø–æ—Ä—Ç –≤–Ω—É—Ç—Ä–∏ —Å–µ—Ä–≤–∏—Å–∞ —ç—Ç–æ 32000, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ —Ç–µ–ø–µ—Ä—å –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ –º—ã –º–æ–∂–µ–º –≤—ã–∑–≤–∞—Ç—å –ø–æ —ç—Ç–æ–º—É –ø–æ—Ä—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:

`curl -v http://localhost:32000/hello`

–ò –ø–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç:

```bash
*   Trying 127.0.0.1:32000...
* TCP_NODELAY set
* Connected to localhost (127.0.0.1) port 32000 (#0)
> GET /hello HTTP/1.1
> Host: localhost:32000
> User-Agent: curl/7.68.0
> Accept: */*
> 
* Mark bundle as not supporting multiuse
< HTTP/1.1 200 OK
< X-Shbr-Lang: python
< X-Shbr-Lang-2: java
< Content-Type: text/plain; charset=utf-8
< Content-Length: 5
< Date: Mon, 22 Aug 2022 22:36:07 GMT
< Server: Python/3.8 aiohttp/3.8.1
< 
* Connection #0 to host localhost left intact
hello
```

##### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

–£–≤–µ–ª–∏—á–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞—à–∏—Ö Pod, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–∞–∫ —ç—Ç–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è. –û–±–Ω–æ–≤–∏–º –Ω–∞—à –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç –∏ —Å–∫–∞–∂–µ–º, —á—Ç–æ –Ω–∞–º –Ω—É–∂–Ω–æ –Ω–µ –æ–¥–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏, –∞ —Ç—Ä–∏, —Ñ–∞–π–ª deployment.3.yaml:

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: shbr-echo
spec:
  replicas: 3 # —Ç—Ä–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  selector:
    matchLabels:
      app: shbr-echo
  template:
    metadata:
      labels:
        app: shbr-echo
    spec:
      containers:
        - image: cr.yandex/crpamim8dasm0u97qtpf/shbr-01-package-docker:latest
          imagePullPolicy: "Always"
          name: shbr-echo
          env: # —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –≤ –∫–∞–∫–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–ø–∞–ª –∑–∞–ø—Ä–æ—Å
            - name: PREFIX # –≤ –∫–∞–∂–¥—ã–π –∫–æ–Ω—Ç–µ–Ω–µ—Ä –∫–ª–∞–¥–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é PREFIX
              valueFrom:
                fieldRef:
                  fieldPath: status.podIP # –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –±–µ—Ä–µ–º –∏–∑ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Å–ª–æ–≤–∞—Ä—è
      restartPolicy: Always
```

–í—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—É:

`cd k8s`

`kubectl -n shbr apply -f deployment.3.yaml`

```
deployment.apps/shbr-echo configured
```

–ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫–∞–∫ –æ—Ç–º–∞—à—Ç–∞–±–∏—Ä–æ–≤–∞–ª–∏—Å—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

`kubectl -n shbr get deployment`

```bash
NAME        READY   UP-TO-DATE   AVAILABLE   AGE
shbr-echo   3/3     3            3           38m
```

–ï—Å–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ —Å–ø–∏—Å–æ–∫ –ø–æ–¥–æ–≤, —Ç–æ —É–≤–∏–¥–∏–º —Ç—Ä–∏ –ø–æ–¥–∞:

`kubectl -n shbr get pod`

```bash
NAME                         READY   STATUS    RESTARTS   AGE
shbr-echo-647887dd4f-4jjxw   1/1     Running   0          2m57s
shbr-echo-647887dd4f-dp55n   1/1     Running   0          2m25s
shbr-echo-647887dd4f-xlztg   1/1     Running   0          2m34s
```

–¢–µ–ø–µ—Ä—å curl –±—É–¥–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ—Ç–≤–µ—Ç —Å ip-–∞–¥—Ä–µ—Å–æ–º, –ø–æ—Ç–æ–º—É —á—Ç–æ –º—ã –µ–≥–æ –ø–æ–ª–æ–∂–∏–ª–∏ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—É—Ä–∂–µ–Ω–∏—è:

`curl -v http://localhost:32000/,hello`

```bash
*   Trying 127.0.0.1:32000...
* TCP_NODELAY set
* Connected to localhost (127.0.0.1) port 32000 (#0)
> GET /,hello HTTP/1.1
> Host: localhost:32000
> User-Agent: curl/7.68.0
> Accept: */*
> 
* Mark bundle as not supporting multiuse
< HTTP/1.1 200 OK
< X-Shbr-Lang: python
< X-Shbr-Lang-2: java
< Content-Type: text/plain; charset=utf-8
< Content-Length: 16
< Date: Mon, 22 Aug 2022 22:48:17 GMT
< Server: Python/3.8 aiohttp/3.8.1
< 
* Connection #0 to host localhost left intact
172.17.0.6,hello
```

–ï—Å–ª–∏ –∑–∞–ø—É—Å—Ç–∏–º –≤ —Ü–∏–∫–ª–µ –Ω–∞—à—É –∫–æ–º–∞–Ω–¥—É:

`watch -n 0.5 'curl -v http://localhost:32000/,hello'`

–í–∏–¥–∏–º, —á—Ç–æ –∫–∞–∂–¥—ã–µ 500 –º—Å –º–µ–Ω—è–µ—Ç—Å—è ip-–∞–¥—Ä–µ—Å –∏ –Ω–∞—à–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ.

–ü–æ—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ –≤–µ–¥–µ—Ç —Å–µ–±—è deployment, –µ—Å–ª–∏ –ª–∏—à–∏—Ç—å –µ–≥–æ –æ–¥–Ω–æ–≥–æ –∏–∑ Pod:

`watch -n 0.5 'kubectl -n shbr get deployments'` # –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ 1

`vagrant ssh` # –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ 2

`cd /vagrant/`# –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ 2

`kubectl -n shbr get pods`# –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ 2

```bash
NAME                         READY   STATUS    RESTARTS   AGE
shbr-echo-647887dd4f-4jjxw   1/1     Running   0          15m
shbr-echo-647887dd4f-dp55n   1/1     Running   0          14m
shbr-echo-647887dd4f-xlztg   1/1     Running   0          14m
```

–£–¥–∞–ª—è–µ–º —Ç—Ä–µ—Ç–∏–π Pod:

`kubectl -n shbr delete pod shbr-echo-647887dd4f-xlztg`

–ù–∞ –∫–∞–∫–æ–µ-—Ç–æ –≤—Ä–µ–º—è –≤ –¢–µ—Ä–º–∏–Ω–∞–ª–µ 1 –ø—Ä–æ—Å–∫–∞–∫–∏–≤–∞–µ—Ç AVAILABLE  2, –≤–º–µ—Å—Ç–æ 3. –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–∏ –∑–∞–ø—É—â–µ–Ω–Ω–æ–π –∫–æ–º–∞–Ω–¥–µ `watch -n 0.5 kubectl -n shbr get pod`.  Deployment —ç—Ç–æ –≤–∏–¥–∏—Ç –∏ –ø–æ–¥–Ω–∏–º–∞–µ—Ç –µ—â–µ –æ–¥–∏–Ω Pod, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—è –∏—Å—Ö–æ–¥–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É. –ú–æ–∂–Ω–æ —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã *events* –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏, –∫–æ–≥–¥–∞ –∏ –∫–∞–∫–∏–µ Pod –ø—Ä–∏—à–ª–æ—Å—å –ø–µ—Ä–µ—Å–æ–∑–¥–≤–∞—Ç—å.

##### –í–∞–∂–Ω—ã–µ –ø–æ–ª—è

- **spec.containers[].resources.** –°–∫–æ–ª—å–∫–æ —Ä–µ—Å—É—Ä—Å–æ–≤ –≤—ã–¥–≤–∞–≤—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É; –µ—Å–ª–∏ –∏—Ö –Ω–µ —É–∫–∞–∑–∞—Ç—å, —Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ—Ç—ä–µ—Å—Ç –≤—Å–µ –º–µ—Å—Ç–æ –Ω–∞ –Ω–æ–¥–µ –∏ —ç—Ç–æ –±—É–¥–µ—Ç –æ—á–µ–Ω—å –ø–ª–æ—Ö–æ, –ø–æ—Ç–æ–º—É, —á—Ç–æ –∫–ª–∞—Å—Ç–µ—Ä –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç –Ω–∞—Å–∫–æ–ª—å–∫–æ –Ω–æ–¥—ã —É –Ω–µ–≥–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏ –∫–∞–∫ –±–æ–ª–µ–µ –≥—Ä–∞–º–æ—Ç–Ω–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ—Ü–Ω–µ—Ä—ã –Ω–∞ —Ç—É –∏–ª–∏ –∏–Ω—É—é –Ω–æ–¥—É.
  
  –¢–∞–∫–∂–µ –≤ kubernetes –µ—Å—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –∞–≤—Ç–æ—Å–∫–µ–π–ª–∏–Ω–≥–∞, –∫–æ–≥–¥–∞ –æ–Ω –º–æ–∂–µ—Ç –≤ –æ–±–ª–∞–∫–µ –¥–æ–∫—É–ø–∞—Ç—å –Ω–æ–≤—ã–µ –Ω–æ–¥—ã. –ú—ã –º–æ–∂–µ–º –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∂–µ–ª–µ–∑–Ω–æ —Ä–µ—Å—É—Ä—Å—ã,  –∏ –¥–æ–ø–∏—Å–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ –æ–Ω –º–æ–∂–µ—Ç –ø–æ–ø—Ä–æ—Å–∏—Ç—å –∏–∑ –æ–±–ª–∞–∫–∞. –ò–¥–µ—è –≤ —Ç–æ–º, —á—Ç–æ –ª–∏–º–∏—Ç—ã –Ω–µ –¥–∞—é—Ç —É—Ç–∏–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±–æ–ª—å—à–µ —Ç–æ–≥–æ –∏–ª–∏ –∏–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞, –∞ requests - —ç—Ç–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è Pod.
  
  <img src="file:///home/vibo/Pictures/GlobalMarkText/2022-08-24-20-24-46-image.png" title="" alt="" data-align="center">

- –ï—â–µ –µ—Å—Ç—å **initContainers**, –∫–æ–≥–¥–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Å–≤–æ–µ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –º–æ–∂–µ–º —Å–æ–≤–µ—Ä—à–∏—Ç—å –∫–∞–∫–∏–µ-—Ç–æ –¥–µ–π—Å—Ç–≤–∏—è. –ù–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –º–æ–∂–µ—Ç —Å–∫–∞—á–∞—Ç—å –∫–∞–∫–æ–π-–Ω–∏–±—É–¥—å —Ñ–∞–π–ª.

- –¢–∞–∫–∂–µ —É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –µ—Å—Ç—å –ø–æ–Ω—è—Ç–∏—è **livenessProbe** –∏ **readnessProbe** - —ç—Ç–æ –Ω–µ–∫–∞—è –∫–æ–º–∞–Ω–¥–∞ –∏–ª–∏ http –∑–∞–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–≤–µ—á–∞—é—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ —Å–µ–π—á–∞—Å –∏–ª–∏ –Ω–µ—Ç. –ù–∞–ø—Ä–∏–º–µ—Ä, –º–µ–∂–¥—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –∏ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö —á—Ç–æ-—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ –∏ –æ–Ω–∞ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –æ–¥–Ω–æ–π –∏–∑ Node. 
  
  –í **readnessProbe** –º—ã –º–æ–∂–µ–º —É–∫–∞–∑–∞—Ç—å –∫–æ–º–∞–Ω–¥—É, –∫–æ—Ç–æ—Ä–∞—è —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –∏–ª–∏ –Ω–µ—Ç –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö. –ò –µ—Å–ª–∏ —ç—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –≥–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –∏ readnessProbe —É–ø–∞–ª, —Ç–æ —Ç–æ–≥–¥–∞ kubernetes —ç—Ç–æ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤—ã–∫–ª—é—á–∏—Ç –∏–∑ –±–∞–ª–∞–Ω—Å–æ—Ä–æ–≤–∫–∏. –ï—Å–ª–∏ **livenessProde** - –±–æ–ª–µ–µ –∂–µ—Å—Ç–∫–∞—è, –µ—Å–ª–∏ –æ–Ω–∞ —É–ø–∞–¥–µ—Ç, —Ç–æ kubernetes —É–¥–∞–ª–∏—Ç –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç Pod —Ü–µ–ª–∏–∫–æ–º.
  
  <img src="file:///home/vibo/Pictures/GlobalMarkText/2022-08-24-20-25-57-image.png" title="" alt="" data-align="center">

##### –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–µ–ø–ª–æ—è

–ö–æ—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º yaml-—Ñ–∞–π–ª–µ. –ó–∞—Ç–µ–º –æ–Ω –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–æ–π `kubectl -n shbr apply -f –ò–ú–Ø_deployment.yaml`. Spec —Ñ–∞–π–ª–∞ –Ω—É–∂–Ω–æ –∫–∞–∫-—Ç–æ –º–µ–Ω—è—Ç—å –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞, —á—Ç–æ–±—ã kubernetes –≤—ã–ø–æ–ª–Ω–∏–ª —Ä–µ–¥–µ–ø–ª–æ–π.

###### Recreate

–†–µ—Å—Ç–∞—Ä—Ç–∏–º –≤—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å—Ä–∞–∑—É. –§–∞–π–ª deployment.3.recreate.yaml:

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: shbr-echo
spec:
  replicas: 3
  strategy:    # –¥–æ–±–∞–≤–∏–ª–∏ –ø–æ–ª–µ
    type: Recreate # –∏ –∑–¥–µ—Å—å –¥–æ–±–∞–≤–∏–ª–∏ Recreate
  selector:
    matchLabels:
      app: shbr-echo
  template:
    metadata:
      labels:
        app: shbr-echo
    spec:
      containers:
        - image: cr.yandex/crpamim8dasm0u97qtpf/shbr-01-package-docker:latest
          imagePullPolicy: "Always"
          name: shbr-echo
          env:
            - name: PREFIX
              valueFrom:
                fieldRef:
                  fieldPath: status.podIP
            - name: RESTART # –∑–¥–µ—Å—å
              value: "1" # –∏ –∑–¥–µ—Å—å
      restartPolicy: Always
```

–î–µ–ª–∞–µ–º —Ç–∞–∫, —á—Ç–æ spec –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∫–∞–∫-—Ç–æ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å –∏ kubernetes –ø–æ–Ω—è–ª, —á—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ —Ä–µ–¥–µ–ø–ª–æ–π –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ —Å—Ç—Ä–∞–µ—Ç–µ–≥–∏–∏ Recreate.

–£ –Ω–∞—Å —É–ø–∞–ª–∏ —Å—Ä–∞–∑ –≤—Å–µ —Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –±—ã—Å—Ç—Ä–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ —Ç—Ä–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —Ä–∞–∑–æ–≤–æ, –Ω–æ –≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç —Ç—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–ª–∏–≤–∞–µ—Ç—Å—è. –ö–æ–≥–¥–∞ –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø—Ä–æ–ø–∞–ª–∏ –Ω–∏–∫—Ç–æ –Ω–µ –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç—Ä–∞—Ñ–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

###### Rolling

–ë–æ–ª–µ–µ —â–µ–¥—è—â–∏–π –ø–æ–¥—Ö–æ–¥ - —É–±–∏–≤–∞–µ—Ç—Å—è –∑–∞ —Ä–∞–∑ —Ç–æ–ª—å–∫–æ —Ç—Ä–µ—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, —Ñ–∞–π–ª deployment.3.rolling.yaml:

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: shbr-echo
spec:
  replicas: 3
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 33%    # –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –º–æ–∂–Ω–æ —É–±–∏—Ç—å —Ç—Ä–µ—Ç—å –∫–æ–Ω—Ç–µ—Ü–Ω–µ—Ä–æ–≤!
      maxUnavailable: 33%
  selector:
    matchLabels:
      app: shbr-echo
  template:
    metadata:
      labels:
        app: shbr-echo
    spec:
      containers:
        - image: cr.yandex/crpamim8dasm0u97qtpf/shbr-01-package-docker:latest
          imagePullPolicy: "Always"
          name: shbr-echo
          env:
            - name: PREFIX
              valueFrom:
                fieldRef:
                  fieldPath: status.podIP
            - name: RESTART
              value: "2"
      restartPolicy: Always
```

–í –¥–∞–Ω–Ω–æ–π —Å—Ö–µ–º–µ kubernetes –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å –ø–æ –æ–¥–Ω–æ–º—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É. –¢–∞–∫–æ–π —Ä–µ–∂–∏–º **–≤—Å–µ–≥–¥–∞** —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ–¥–∏–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞–±–æ—á–∏–π. –¢–∞–∫–∞—è —Å—Ö–µ–º–∞ —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ —Ä–µ—Å—É—Ä—Å–æ–≤. –í—Å–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–±–ª–∞—Å—Ç–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è. Recreate - –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á, —ç—Ç–∞ –∏—Å—Ç–æ—Ä–∏—è –Ω–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

###### BlueGreen

–°–∞–º–∞—è –¥–æ—Ä–æ–≥–∞—è —Å—Ö–µ–º–∞, –∫–æ–≥–¥–∞ –º—ã —Ü–µ–ª–∏–∫–æ–º –ø–æ–¥–Ω–∏–º–∞–µ–º –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ –Ω–µ–µ. –ü—Ä–æ—Å—Ç–æ –æ–Ω–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è. –ë–µ–∑ —Ç–∞–Ω—Ü–µ–≤ —Å –±—É–±–Ω–æ–º –Ω–µ –æ–±–æ–π—Ç–∏—Å—å.

–£ –Ω–∞—Å –µ—Å—Ç—å –¥–≤–µ spec, –æ—Ç–ª–∏—á–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –º–µ—Ç–∫–æ–π.

–§–∞–π–ª deployment-1.yaml:

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: shbr-echo-1 # –Ω–∞–∑–≤–∞–Ω–∏–µ
spec:
  replicas: 3
  selector:
    matchLabels:
      app: shbr-echo
  template:
    metadata:
      labels:
        app: shbr-echo
        version: "1" # –º–µ—Ç–∫–∞
    spec:
      containers:
        - image: cr.yandex/crpamim8dasm0u97qtpf/shbr-01-package-docker:latest
          name: shbr-echo
          env:
            - name: PREFIX
              valueFrom:
                fieldRef:
                  fieldPath: status.podIP
      restartPolicy: Always
```

–§–∞–π–ª deployment-2.yaml:

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: shbr-echo-2 # –Ω–∞–∑–≤–∞–Ω–∏–µ
spec:
  replicas: 3
  selector:
    matchLabels:
      app: shbr-echo
  template:
    metadata:
      labels:
        app: shbr-echo
        version: "2" # –º–µ—Ç–∫–∞
    spec:
      containers:
        - image: cr.yandex/crpamim8dasm0u97qtpf/shbr-01-package-docker:latest
          name: shbr-echo
          env:
            - name: PREFIX
              valueFrom:
                fieldRef:
                  fieldPath: status.podIP
      restartPolicy: Always
```

–°–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –¥–µ–ª–∞—Ç—å –ø—É–±–ª–∏–∞—Ü–∏—é –Ω–∞—à–∏—Ö Pod. –ú—ã –º–æ–∂–µ–º —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç-2 –∏ –≤–Ω—É—Ç—Ä–∏ —Å–µ—Ä–≤–∏—Å–∞ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É kubernetes –ø–æ–Ω–∏–º–∞–µ—Ç –∫—É–¥–∞ –Ω—É–∂–Ω–æ –ª–∏—Ç—å —Ç—Ä–∞—Ñ–∏–∫. –§–∞–π–ª service.yaml:

```yaml
apiVersion: v1
kind: Service
metadata:
  name: shbr-echo-bluegreen
  labels:
    app: shbr-echo-bluegreen
spec:
  type: NodePort
  ports:
  - port: 10000
    nodePort: 32001 # –ø–æ—Ä—Ç
    protocol: TCP
  selector:
    app: shbr-echo
    version: "1"    # –º–µ–Ω—è–µ–º —Ä—É–∫–∞–º–∏ –Ω–∞ 2, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å 
```

–°–æ–∑–¥–∞—é—Ç—Å—è –¥–≤–µ —Ç—Ä–æ–π–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤. –¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ service.yaml –∏ –º–µ–Ω—è–µ–º selector version, –≤–µ—Å—å —Ç—Ä–∞—Ñ–∏–∫ —Ç–µ–ø–µ—Ä—å –ª—å–µ—Ç—Å—è —á–µ—Ä–µ–∑ deployment-2. –¢–µ–ø–µ—Ä—å –≤—Ä—É—á–Ω—É—é —É–¥–∞—è–µ–º deployment-1. –°–∞–º–∞—è –¥–æ—Ä–æ–≥–∞—è –∏—Å—Ç–æ—Ä–∏—è.

##### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

–î–ª—è —Ä–∞–±–æ—Ç—ã –≤ kubernetes –µ—Å—Ç—å –¥–≤–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ ¬†HELM –∏ ¬†Kustomizer, Kustomizer –≤—Ö–æ–¥–∏—Ç —Å–µ–π—á–∞—Å –≤ kubectl –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –ø–æ—Å—Ç–∞–≤–∫—É. –° –ø–æ–º–æ—â—å—é —ç—Ç–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å —Ñ–∞–π–ª—ã, –ø–æ–ª–æ–∂–∏—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —á–∞—Ä—Ç—ã –∏ —Ç.–¥.

–î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π:

###### HELM

–í HELM –≤—Å–µ —Å–ø–µ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –ø–∏—Å–∞–ª–∏ —Ä—É–∫–∞–º–∏ –º–æ–∂–Ω–æ —à–∞–±–ª–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å. –¢.–µ. —É –Ω–∞—Å –µ—Å—Ç—å —Å–ø–µ–∫–∞ –∏ —Ñ–∞–π–ª —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏ –º—ã –º–æ–∂–µ–º —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, –º–µ–Ω—è—Ç—å –∏ –Ω–∞–∫–∞—Ç—ã–≤–∞—Ç—å. –ó–∞—Ö–æ—Ç–µ–ª–∏ –ø–æ–º–µ–Ω—è—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è - –Ω–∞–º –Ω–µ –Ω–∞–¥–æ –∏–¥—Ç–∏ –≥–ª—É–±–æ–∫–æ –≤–Ω—É—Ç—å –≤—Å–µ—Ö —Å–ø–µ–∫, –∏—Å–∫–∞—Ç—å, –≥–¥–µ —ç—Ç–∞ –ø–µ—Ä–º–µ–Ω–Ω–∞—è –∑–∞–¥–∞–µ—Ç—Å—è. –ü–æ–º–µ–Ω—è–ª–∏ –∑–∞—Ä–∞–Ω–µ–µ –∑–∞–¥–∞–Ω–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—Ç—É—é –∏ —ç—Ç–æ –º–æ–≥–ª–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—é –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Å–ø–µ–∫. –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å include, if. 

###### Kustomizer

Kustomizer - –±–æ–ª–µ–µ –∑–∞—Ç–µ–π–ª–∏–≤—ã–π. –í –Ω–µ–º –µ—Å—Ç—å –±–∞–∑–æ–≤–∞—è —Å–ø–µ–∫–∞, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏—è, –º—ã –º–æ–∂–µ–º –Ω–∞ —ç—Ç—É—é —Å–∫–µ–ø—É –Ω–∞–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –ø–∞—Ç—á–∏. –≠—Ç–∏ –ø–∞—Ç—á–∏ –±—É–¥—É—Ç –Ω–∞–∫–ª–∞–¥—ã–≤–∞—Ç—å—Å—è –Ω–∞ –±–∞–∑–æ–≤—É—é –∏ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –º–µ–Ω—è—Ç—å—Å—è –≤ –≥–ª—É–±–∏–Ω—É.

–î–ª—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è:

###### k9s

`k9s -A`

<img title="" src="file:///home/vibo/Pictures/GlobalMarkText/2022-08-23-14-45-13-image.png" alt="" data-align="center">

–ö–∞–∫ kubectl, —Ç–æ–ª—å–∫–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ. –ò –≤—Å–µ —Ç–µ —Ä–µ—Å—É—Ä—Å—ã –∫–æ—Ç–æ—Ä—ã–µ –º—ã –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –≤ kubectl –º–æ–∂–µ–º –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –∑–¥–µ—Å—å. –°—É–ø–µ—Ä—Ñ–∏—á–∞ - –º—ã –º–æ–∂–µ–º –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ –ø—Ä–æ–≤–∞–ª–∏–≤–∞—Ç—å—Å—è –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (hot-key s, —Ç.–µ shell). –¢–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–µ–Ω –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤, stdout –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –º–æ–∂–Ω–æ —Ç–∞–∫–∂–µ —É–¥–æ–±–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å.

**–ö–∞–∫ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –≤ –ø—Ä–æ–¥–µ**

–í –Ø–Ω–¥–µ–∫—Å-–æ–±–ª–∞–∫–µ –µ—Å—Ç—å meneged-kubernates-servise. –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Ç–µ—Ä, –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –Ω–µ–º—É —Å–Ω–∞—Ä—É–∂–∏. –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞ –µ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–±–æ—á–µ–π –≥—Ä—É–ø–ø—ã –∏ kubernetes —Å–æ–∑–∞–¥–µ—Ç node –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–≤–æ –≤–∫–ª–∞–¥–∫–µ compute-cloude).

### –í–æ–ø—Ä–æ—Å—ã

–ö–∞–∫ –Ω–∞ —É—Ä–æ–≤–Ω–µ –û–° –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é—Ç—Å—è —Ä–µ—Å—É—Ä—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–∞—è –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è, –≤ —á–∞—Å—Ç–Ω–æ—Å—Ç–∏ –¥–æ–∫–µ—Ä - —ç—Ç–æ –ø–æ —Å—É—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏ –ª–∏–Ω—É–∫—Å —Å –ø–æ–º–æ—â—å—é –º–µ—Ö–∞–Ω–∏–∑–º–∞ —Å–∏-–≥—Ä—É–ø –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–∫–æ–ª—å–∫–æ –∏ –∫–∞–∫–æ–º—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –≤—ã–¥–µ–ª—è—Ç—å –≤—Ä–µ–º–µ–Ω–∏.

–ß—Ç–æ–±—ã –æ–ø–∏—Å–∞—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–π —Å–µ—Ä–≤–∏—Å yaml —Ñ–∞–π–ª —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é. –î–∞–ª–µ–µ —á–µ—Ä–µ–∑ kubectl apply –º—ã –ø–µ—Ä–µ–¥–∞–µ–º –∏—Ö –≤ api. –ü–æ–≤–µ—Ä—Ö kubertetes –µ—Å—Ç—å —É–∂–µ –º–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –º–æ–∂–Ω–æ –Ω–∞–∫–ª–∏–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é.

–ö–∞–∫ –¥–æ—Å—Ç—É—á–∞—Ç—å—Å—è –¥–æ Pada —Å–Ω–∞—Ä—É–∂–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞. –ó–∞ —ç—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç —Å–µ—Ä–≤–∏—Å, –ø–∞—Ä–∞–º–µ—Ç—Ä nodePort: 32001 # –ø–æ—Ä—Ç. –ï—Å—Ç—å —Ç—Ä–∏ —Ç–∏–ø–∞ —Å–µ—Ä–≤–∏—Å–∞:

- NodePort (—ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–µ–Ω Docker SWARM);

- ClusterIP (—ç—Ç–æ —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π ip –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ);

- LoadBalanser (—Å–∞–º—ã–π —Å–ª–æ–∂–Ω—ã–π –∏ –¥–æ—Ä–æ–≥–æ–π, –≤–Ω–µ—à–Ω–∏–π ip). 

### 7. CI/CD

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ–º –≤—Å–µ —ç—Ç–æ –¥–µ–ª–æ.

**Time to Market** - —ç—Ç–æ –≤—Ä–µ–º—è, –∫–æ—Ç–æ—Ä–æ–µ –∫–æ–º–ø–∞–Ω–∏—è —Ç—Ä–∞—Ç–∏—Ç –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∏ –≤—ã–ø—É—Å–∫ –±–∏–∑–Ω–µ—Å-–∏–¥–µ–∏ —Å–≤–æ–∏–º –∫–ª–∏–µ–Ω—Ç–∞–º. –ß–µ–º –Ω–∏–∂–µ time to market, —Ç–µ–º –±—ã—Å—Ç—Ä–µ–µ —Ñ–∏—á–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –ø—Ä–æ–¥–∞–∫—à–Ω –∏ –ø—Ä–∏–Ω–æ—Å–∏ –ø—Ä–∏–±—ã–ª—å.

–° –ø–æ–º–æ—â—å—é CI/CD —Å–µ—Ä–≤–∏—Å–æ–≤ –º—ã –≤—ã–≥—Ä—É–∂–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ–∏–π –∏ –æ–Ω–æ –≤—ã–µ–∑–∂–∞–µ—Ç –≤ –ø—Ä–æ–¥.

–ú—ã –±—É–¥–µ–º —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å CI - gitlab.[—Å—Å—ã–ª–∫–∞](https://docs.gitlab.com/ee/ci/quick_start/). CI –≤ –≥–∏—Ç–ª–∞–±–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Å–ø–∏—Å–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π, –ø–æ—Ö–æ–∂ –Ω–∞ Ansible. –ü—Ä–∏–º–µ—Ä –Ω–∏–∂–µ –ø—Ä–µ–¥—É—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç —á–µ—Ç—ã—Ä–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –∫–∞–∂–¥–∞—è –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —Ä–∞–∑–Ω–µ—Å–µ–Ω–∞ –Ω–∞ stage.

##### .gitlab-ci (–ø—Ä–∏–º–µ—Ä)

–û–ø–∏—Å–∞–Ω–∏–µ –ø–∞–π–ø–ª–∞–π–Ω–∞. –§–∞–π–ª `.gitlab-ci.yml` - –ø—Ä–∏–º–µ—Ä:

```yaml
build-job:
  stage: build
  script:
    - echo "Hello, $GITLAB_USER_LOGIN!"

test-job1:
  stage: test
  script:
    - echo "This job tests something"

test-job2:
  stage: test
  script:
    - echo "This job tests something, but takes more time than test-job1."
    - echo "After the echo commands complete, it runs the sleep command for 20 seconds"
    - echo "which simulates a test that runs 20 seconds longer than test-job1"
    - sleep 20

deploy-prod:
  stage: deploy
  script:
    - echo "This job deploys something from the $CI_COMMIT_BRANCH branch."
```

##### Vagrantfile

–ü—Ä–æ–±–æ–≤–∞—Ç—å GitLab –±—É–¥–µ–º –ª–æ–∫–∞–ª—å–Ω–æ, –æ–ø–∏—Å–∞–Ω–∏–µ Vagrantfile:

```bash
Vagrant.configure("2") do |config|
    config.vm.box_check_update = false
    config.vbguest.installer_options = { allow_kernel_upgrade: true } # vagrant plugin install vagrant-vbguest
    # –∑–∞–≤–æ–¥–∏–º –ø–æ—Ä—Ç—ã –≤–Ω—É—Ç—Ä—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã
    config.vm.network "forwarded_port", guest: 8080, host: 8080, host_ip: '127.0.0.1', protocol: 'tcp', auto_correct: true
    config.vm.network "forwarded_port", guest: 2222, host: 22022, host_ip: '127.0.0.1', protocol: 'tcp', auto_correct: true

    config.vm.define "ci" do |node| # –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã
        node.vm.box = "ubuntu/focal64"
        node.vm.hostname = "ci"
        node.vagrant.host = "ci"

        node.vm.provider "virtualbox" do |v|
            v.name = "ci"
            v.memory = 6144 # –≤—ã–¥–µ–ª—è–µ–º –º–∞—à–∏–Ω–µ –ø–æ–±–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏
            v.cpus = 5
        end

        node.vm.provision "shell" do |s|
        s.inline = <<-SHELL
        set -e
        apt-get update
        apt-get install -y apt-transport-https ca-certificates curl gnupg-agent software-properties-common

        curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add -
        add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"

        # —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–æ–∫–µ—Ä
        apt-get update
        apt-get install -y docker-ce docker-ce-cli docker-compose containerd.io conntrack
        systemctl enable docker
        systemctl start docker
        usermod -a -G docker vagrant

        # —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º minikube
        curl -L https://github.com/kubernetes/minikube/releases/download/v1.23.2/minikube_1.23.2-0_amd64.deb > minikube_1.23.2-0_amd64.deb
        dpkg -i minikube_1.23.2-0_amd64.deb
        sudo -u vagrant minikube start --driver=none

        snap install kubectl --classic
        curl -sS https://webinstall.dev/k9s | sudo -u vagrant bash

        # —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º GitLab —Ä–∞–Ω–µ—Ä
        curl -L "https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.deb.sh" | sudo bash
        apt-get update
        apt-get install -y gitlab-runner
        usermod -a -G docker gitlab-runner

        mv ~/.bash_logout ~/.bash_logout.bak 2>/dev/null || true
        SHELL
        s.privileged = true
        end
    end
end
```

`vagrant up`

`vagrant ssh`

`cd /vagrant/`

`ls`

```bash
Vagrantfile         gitlab-runner.service  k8s
docker-compose.yml  hint.sh                virtualbox
```

##### docker-compose

GitLab –ø–æ–¥–Ω–∏–º–µ–º —Å –ø–æ–º–æ—â—å—é –¥–æ–∫–µ—Ä-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, —Ñ–∞–π–ª docker-compose.yml:

```yml
version: "2.4"

services:
  gitlab: # –æ–±—ä—è–≤–ª—è–µ–º –Ω–µ–∫–∏–π —Å–µ—Ä–≤–∏—Å gitlab
    image: gitlab/gitlab-ce:14.3.3-ce.0 # —Å–µ—Ä–≤–∏—Å –ø–æ–¥–Ω–∏–º–∞—Ç—å –∏–∑ —ç—Ç–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
    restart: always # –µ—Å–ª–∏ —É–ø–∞–¥–µ—Ç - –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å
    hostname: 'localhost'
    environment: # –∑–∞–¥–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è, –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ gitlab
      GITLAB_ROOT_EMAIL: "shbr@yandex-team.ru" # –ª–æ–≥–∏–Ω
      GITLAB_ROOT_PASSWORD: "yandex-shbr" # –ø–∞—Ä–æ–ª—å
      GITLAB_OMNIBUS_CONFIG: | # –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥, —Ç.–∫. –µ—Å—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ –ø–æ—Ä—Ç–∞–º
        external_url 'http://localhost:8080'
        gitlab_rails['gitlab_shell_ssh_port'] = 2222
        puma['port'] = 8081
    container_name: gitlab
    ports:
      - '8080:8080'
      - '2222:22'
    volumes: # l—Å–æ–∑–¥–∞–µ–º –¥–∏—Ä—Ä–µ–∫—Ç–∏—Ä–∏–∏, —á—Ç–æ–±—ã –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ —ç—Ç–∏ —Ñ–∞–π–ª—ã –Ω–µ —Ç–µ—Ä—è–ª–∏—Å—å
      - '/gitlab/etc:/etc/gitlab'
      - '/gitlab/logs:/var/log/gitlab'
      - '/gitlab/data:/var/opt/gitlab'
  demo:
    image: ubuntu:focal
    container_name: demo
    command:
      - /bin/tail
      - -f
      - /dev/null
```

–ü–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è docker-compose –∫–æ–º–∞–Ω–¥–æ–π `docker-compose up` (–µ—Å–ª–∏ –æ–¥–∏–Ω —Ñ–∞–π–ª) –∏–ª–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞:

`docker-compose -f docker-compose.yml up -d`

```
Starting demo ... 
Starting demo ... done
```

–§–ª–∞–≥ -d, —á—Ç–æ–±—ã –¥–æ–∫–µ—Ä –∑–∞–ø—É—Å—Ç–∏–ª—Å—è, –∞ –∫–æ–Ω—Å–æ–ª—å –≤–µ—Ä–Ω—É–ª–∞—Å—å –Ω–∞–º.

`docker ps`

–í–∏–¥–∏–º, —á—Ç–æ –∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å –º–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, –≤ —Ç.—á. c GitLab. –°–º–æ—Ç—Ä–∏–º –Ω–∞ –ª–æ–≥–∏.

`docker logs -f 5962e680b906` # –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä GitLab

–í–∏–¥–∏–º –æ—á–µ–Ω—å –±–æ–ª—å—à—É—é –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—é. –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç gitlab c —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è. –í –Ω–∞—á–∞–ª–µ –µ—Å—Ç—å —Å—Ç—Ä–æ–∫–∞ *Chef Infra Client* - —ç—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π, —Å–∏—Å—Ç–µ–º–∞ —Å—Ç–∞—Ä–∞—è, –∞–Ω–∞–ª–æ–≥ Ansible. –í —Å–∏—Å—Ç–µ–º–µ –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤: –±—ç–∫–µ–Ω–¥ api, —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ —Å–æ –≤—Å–µ–º–∏ –∫–Ω–æ–ø–æ—á–∫–∞–º–∏, postges –¥–ª—è –¥–∞–Ω–Ω—ã—Ö, git shell –∏ —Ç.–¥. –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ gitlab –Ω–∞–ø–∏—Å–∞–ª–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–æ Cookbooks (–∏—Ö –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ –µ—Å—Ç—å –≤ –ª–æ–≥–∞—Ö). –í–∏–¥–∏–º, –∫–∞–∫ —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è –Ω–∞—à–∏ –∫–æ–Ω—Ñ–∏–≥–∏, –Ω–∞–º –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–∞–¥–∞–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ —Ñ–∞–π–ª docker-compose.yml. –ö–æ–≥–¥–∞ –º—ã –∑–∞–¥–∞–µ–º –∏—Ö –≤ —Ñ–∞–π–ª–µ Chief –∏—Ö –ø—Ä–æ—á–∏—Ç–∞–ª –∏ –≤ –∫–æ–Ω—Ñ–∏–≥–∏ –æ—Ç—Ä–µ–Ω–¥–µ—Ä–∏–ª, –ø–æ–ª–æ–∂–∏–ª –Ω–∞ –¥–∏—Å–∫. –ö–æ–≥–¥–∞ gitlab –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –±—É–¥—É—Ç –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ñ–∏–≥–æ–≤. –≠—Ç–æ –æ—á–µ–Ω—å —É–¥–æ–±–Ω–æ. –î–∞–ª—å—à–µ –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –∫–æ–Ω—Ñ–∏–≥–∏ postgrs. –í –ª–æ–≥–∞—Ö –ø–æ—à–ª–∏ http-–∑–∞–ø—Ä–æ—Å—ã. GitLab –ø–æ–¥–Ω—è–ª—Å—è.

##### –ë—Ä–∞—É–∑–µ—Ä

`http://localhost:8080/users/sign_in`

–í–≤–æ–¥–∏–º –ª–æ–≥–∏–Ω (shbr@yandex-team.ru) –∏ –ø–∞—Ä–æ–ª—å (yandex-shbr), —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç.

![](/home/vibo/Pictures/GlobalMarkText/2022-08-24-22-41-53-image.png)

##### push –≤ gitlab

–¢–µ–ø–µ—Ä—å –Ω–∞–º –Ω—É–∂–Ω–æ —á—Ç–æ-—Ç–æ –ø–æ–ª–æ–∂–∏—Ç—å –≤ GitLab, —á—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å CI. –•–æ—Ç–∏–º –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤–µ—Å—å –Ω–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –≤ GitLab. –í –ø–∞–ø–∫–µ shbr-devops-master –≤—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—ã –ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ gitlab:

`git init --initial-branch=main`

`git remote add origin ssh://git@localhost:22022/root/shbr.git` # –∑–¥–µ—Å—å –≤–∞–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –ø–æ—Ä—Ç 22022, –≤ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –±—ã–ª –ø–æ—Ä—Ç 2222

`git add .`

`git commit -m "Initial commit"`

–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∞–π–ª shbr-devops-master/.git/config

```bash
[core]
    repositoryformatversion = 0
    filemode = true
    bare = false
    logallrefupdates = true
[remote "origin"]
    url = ssh://git@localhost:22022/root/shbr.git # –ø–æ—Ä—Ç 22022!!!
    fetch = +refs/heads/*:refs/remotes/origin/*
```

–û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–∞–π–ª—ã –≤ gitlab (–Ω–µ –∑–∞–±—ã–≤–∞–µ–º, —á—Ç–æ –≤—Å–µ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ). 

–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ –ø–µ—Ä–µ–¥ push –Ω—É–∂–Ω–æ –µ—â–µ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π –ø—É–±–ª–∏—á–Ω—ã–π ssh-–∫–ª—é—á –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ gitlab. –í –ø—Ä–æ—Ü–µ—Å—Å–µ —Å–æ–≥–ª–∞—à–∞–µ–º—Å—è –∏ –ø–∏—à–µ–º yes.

`git push -u origin main`

```bash
The authenticity of host '[localhost]:22022 ([127.0.0.1]:22022)' can't be established.
ED25519 key fingerprint is SHA256:jO+lut6L+8ATEwkbUprphQexMzubapj1xvFtosWgAOM.
This key is not known by any other names
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '[localhost]:22022' (ED25519) to the list of known hosts.
Enumerating objects: 121, done.
Counting objects: 100% (121/121), done.
Delta compression using up to 8 threads
Compressing objects: 100% (95/95), done.
Writing objects: 100% (121/121), 73.48 KiB | 9.18 MiB/s, done.
Total 121 (delta 20), reused 0 (delta 0), pack-reused 0
remote: Resolving deltas: 100% (20/20), done.
To ssh://localhost:22022/root/shbr.git
 * [new branch]      main -> main
branch 'main' set up to track 'origin/main'.
```

–ò—Ç–æ–≥–æ —Ñ–∞–π–ª—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π gitlab –∑–∞–≥—Ä—É–∂–µ–Ω—ã, –≤ –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –ª–µ–∂–∏—Ç —Ñ–∞–π–ª .gitlab-ci.yml.

![](/home/vibo/Pictures/GlobalMarkText/2022-08-24-23-24-28-image.png)

–í–∏–¥–∏–º, —á—Ç–æ —Å—Ç–∞—Ç—É—Å Pipeline: Pending (–≤ –æ–∂–∏–¥–∞–Ω–∏–∏). –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –≤–∫–ª–∞–¥–∫—É pipelines, –≤–∏–¥–∏–º –º–µ—Ç–∫—É stuck (–∑–∞—Å—Ç—Ä—è–ª), –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤–æ –≤–∫–ª–∞–¥–∫—É jobs —Ç–∞–º –≤—ã–±–∏—Ä–∞–µ–º pending –∏ —Å–º–æ—Ç—Ä–∏–º –Ω–∞ –ø—Ä–∏—á–∏–Ω—É:

```
This job is stuck because you don't have any active runners that can run this job.
Go to project CI settings

–≠—Ç–æ –∑–∞–¥–∞–Ω–∏–µ –∑–∞–≤–∏—Å–ª–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ —É –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–∞–Ω–µ—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥–ª–∏ –±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ.
–ü–µ—Ä–µ–π—Ç–∏ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º CI –ø—Ä–æ–µ–∫—Ç–∞
```

##### specific runners

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –ø–æ —Å—Å—ã–ª–∫–µ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É CI/CD. –ù–∞–º –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å gitlab runner –∏ —É–∫–∞–∑–∞—Ç—å —Ö–æ—Å—Ç –∏ –Ω–µ–∫–∏–π —Å–µ–∫—Ä–µ—Ç.

<img src="file:///home/vibo/Pictures/GlobalMarkText/2022-08-24-23-33-29-image.png" title="" alt="" data-align="center">

–ü—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É 06-gitlab –æ—Ç–∫—É–¥–∞ –∑–∞–ø—É—Å–∫–∞–ª–∏ vagrant

`vagrant ssh` # –ø–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ –º–∞—à–∏–Ω–µ

`cd /vagrant/`

–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é

`curl http://localhost:8080/`

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–≤–µ—á–∞–µ—Ç

```bash
<html><body>You are being <a href="http://localhost:8080/users/sign_in">redirected</a>.</body></html>
```

GitLab runner –º—ã –ø—Ä–æ–ø–∏—Å—ã–≤–∞–ª–∏ —Ä–∞–Ω–µ–µ –≤ —Ñ–∞–π–ª–µ Vagrantfile. –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π gitlab, –∏–¥–µ–º —Ç—É–¥–∞.

vagrant@ci: `/etc/apt$ cd /etc/apt/sources.list.d/`

–í–∏–¥–∏–º, —á—Ç–æ –∑–¥–µ—Å—å –ª–µ–∂–∏—Ç runner

```
runner_gitlab-runner.list
```

`cat runner_gitlab-runner.list`—Å–æ

```bash
# this file was generated by packages.gitlab.com for
# the repository at https://packages.gitlab.com/runner/gitlab-runner

deb [signed-by=/usr/share/keyrings/runner_gitlab-runner-archive-keyring.gpg] https://packages.gitlab.com/runner/gitlab-runner/ubuntu/ focal main
deb-src [signed-by=/usr/share/keyrings/runner_gitlab-runner-archive-keyring.gpg] https://packages.gitlab.com/runner/gitlab-runner/ubuntu/ focal main
```

–í–∏–¥–∏–º deb-–ø–∞–∫–µ—Ç—ã –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ, –∏ src-–ø–∞–∫–µ—Ç—ã (—Å–æ–¥–µ—Ä–∂–∞—Ç –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –∏ —á–∞—Å—Ç–æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—é—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å –∫–æ–¥–æ–º, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ —Å–∫–∞—á–∞—Ç—å –ø–∞–∫–µ—Ç —Å –∫–æ–¥–æ–º, —á—Ç–æ-—Ç–æ –ø–æ–¥–ø—Ä–∞–≤–∏—Ç—å –∏ —Å–æ–±—Ä–∞—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø–∞–∫–µ—Ç, –æ—Å–æ–±–µ–Ω–Ω–æ —ç—Ç–æ —É–¥–æ–±–Ω–æ –≤ rpm).

##### gitlab-runner

–¢.–∫. –º—ã —É–∂–µ –∑–∞—Ä–∞–Ω–µ–µ –ø–æ—Å—Ç–∞–≤–∏–ª–∏ runner –Ω–∞–º –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –µ–≥–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å

`gitlab-runner register`

–ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –æ–ø—Ä–æ—Å–Ω–∏–∫. –ö–æ–ø–∏—Ä—É–µ–º url, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–º –≤—ã–¥–∞–ª–∏ (http://localhost:8080/), —Å–µ–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω (oNeTcSVffMkcrR1wCWVv), –æ–ø–∏—Å–∞–Ω–∏–µ, —Ç–µ–≥–∏ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–Ω–Ω–µ—Ä–æ–≤ —ç—Ç–æ —É–¥–æ–±–Ω–æ. –ò –≥–ª–∞–≤–Ω—ã–π –≤–æ–ø—Ä–æ—Å –ø—Ä–æ executor - –≥–¥–µ –º—ã –±—É–¥–µ–º –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–º–∞–Ω–¥—ã, –ø–∏—à–µ–º shell. –¢—É—Ç –º–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤.

–ò—Ç–æ–≥–æ –Ω–∞–º –≥–æ–≤–æ—Ä—è—Ç, —á—Ç–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ /home/vagrant/.gitlab-runner/config.toml

```bash
Runtime platform                                    arch=amd64 os=linux pid=20672 revision=bbcb5aba version=15.3.0
WARNING: Running in user-mode.                     
WARNING: The user-mode requires you to manually start builds processing: 
WARNING: $ gitlab-runner run                       
WARNING: Use sudo for system-mode:                 
WARNING: $ sudo gitlab-runner...                   

Enter the GitLab instance URL (for example, https://gitlab.com/):
http://localhost:8080/
Enter the registration token:
oNeTcSVffMkcrR1wCWVv
Enter a description for the runner:
[ci]: ci
Enter tags for the runner (comma-separated):

Enter optional maintenance note for the runner:

Registering runner... succeeded                     runner=oNeTcSVf
Enter an executor: docker, docker-ssh, parallels, virtualbox, docker-ssh+machine, kubernetes, custom, shell, ssh, docker+machine:
shell
Runner registered successfully. Feel free to start it, but if it's running already the config should be automatically reloaded!

Configuration (with the authentication token) was saved in "/home/vagrant/.gitlab-runner/config.toml" 
```

–ú–æ–∂–Ω–æ —ç—Ç–æ—Ç —Ñ–∞–π–ª –±—ã–ª–æ –∏ —Ä—É–∫–∞–º–∏ —Å–æ–∑–¥–∞—Ç—å, –∫–∞–∫ —É–¥–æ–±–Ω–µ–µ.

`cat /home/vagrant/.gitlab-runner/config.toml`

```bash
concurrent = 1 # —Ä–∞–Ω–Ω–µ—Ä –º–æ–∂–µ—Ç –æ—Å—É—â–µ—Ç—Å–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É —Å–±–æ—Ä–∫—É –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
check_interval = 0

[session_server]
  session_timeout = 1800

[[runners]]
  name = "ci"
  url = "http://localhost:8080/"
  id = 1
  token = "8L95ksppRjAHhDzdoxJt"
  token_obtained_at = 2022-08-24T20:57:55Z
  token_expires_at = 0001-01-01T00:00:00Z
  executor = "shell"
  [runners.custom_build_dir]
  [runners.cache]
    [runners.cache.s3]
    [runners.cache.gcs]
    [runners.cache.azure]
```

–û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É [Sign in ¬∑ GitLab](http://localhost:8080/root/shbr/-/settings/ci_cd#js-runners-settings)

<img src="file:///home/vibo/Pictures/GlobalMarkText/2022-08-25-00-04-02-image.png" title="" alt="" data-align="center">

–†–∞–Ω–Ω–µ—Ä –¥–æ–±–∞–≤–∏–ª—Å—è. –û–Ω –∏–º–µ–µ—Ç —Å—Ç–∞—Ç—É—Å specific, —á—Ç–æ –∑–Ω–∞—á—Ç –æ–Ω –ø—Ä–∏–±–∏—Ç –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø—Ä–æ–µ–∫—Ç—É. –ó–∞—Ö–æ–¥–∏–º –≤–Ω—É—Ç—Ä—å, –≤–∏–¥–∏–º —Ä–∞–∑–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–∞–Ω–Ω–µ—Ä–µ. –ì–ª–∞–≤–Ω—É—é, Last contact - Never, —ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ —Ä–∞–Ω–Ω–µ—Ä –µ—â–µ –æ–±—Ä–∞—â–∞–ª—Å—è –∫ gitlab.

##### –ó–∞–ø—É—Å–∫

–¢–µ–ø–µ—Ä—å –∑–∞–¥–∞—á–∞ - –∑–∞–ø—É—Å—Ç–∏—Ç—å.

`mkdir  /home/vagrant/gitlab-runner`

`/usr/bin/gitlab-runner run --working-directory /home/vagrant/gitlab-runner`

```
Runtime platform                                    arch=amd64 os=linux pid=22855 revision=bbcb5aba version=15.3.0
Starting multi-runner from /home/vagrant/.gitlab-runner/config.toml...  builds=0
WARNING: Running in user-mode.                     
WARNING: Use sudo for system-mode:                 
WARNING: $ sudo gitlab-runner...                   

Configuration loaded                                builds=0
listen_address not defined, metrics & debug endpoints disabled  builds=0
[session_server].listen_address not defined, session endpoints disabled  builds=0
Checking for jobs... received                       job=1 repo_url=http://localhost:8080/root/shbr.git runner=8L95kspp
```

–ü–æ—à–µ–ª –ø—Ä–æ—Ü–µ—Å—Å —É—Å—Ç–∞–Ω–æ–≤–∫–∏. –°—Ç–∞—Ç—É—Å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ gitlab –∏–∑–º–µ–Ω–∏–ª—Å—è.

–ü—Ä–æ–±–ª–µ–º–∞ - –∫–æ–Ω—Å–æ–ª—å –∑–∞–Ω—è—Ç–∞ gitlab runner. –í—Å–ø–æ–º–∏–Ω–∞–µ–º, –∫–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–µ—Ä–≤–∏—Å—ã. –¢.–∫. –º—ã –≤–Ω—É—Ç—Ä–∏ vagrant –≤–∏—Ä—Ç—É–∞–ª–∫–∏ - —Å–ø–æ–º–æ—â—å—é systemd –∑–∞–ø—É—Å—Ç–∏–º –Ω–∞—à runner.

–í—ã—Ö–æ–¥–∏–º `ctrl`+`C`

`cd /vagrant/`

`cat gitlab-runner.service`

```bash
[Unit]
Description=gitlab-runner

[Service]
ExecStart=/usr/bin/gitlab-runner run --working-directory /home/vagrant/gitlab-runner

[Install]
WantedBy=default.target
```

–£ –Ω–∞—Å –µ—Å—Ç—å —Å–µ—Ä–≤–∏—Å-—Ñ–∞–π–ª –∏ –Ω–∞—à–∞ –∑–∞–¥–∞—á–∞ –ø–æ–ª–æ–∂–∏—Ç—å –µ–≥–æ –≤ –Ω—É–∂–Ω–æ–µ –º–µ—Å—Ç–æ. –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ–¥ —Å–µ–±—è —Å–µ—Ä–≤–∏—Å—ã. –ù–∞—à –±—É–¥–µ—Ç –∏–º–µ–Ω–Ω–æ —Ç–∞–∫–∏–º.

`cat hint.sh` # —Å–º–æ—Ç—Ä–∏–º —Ñ–∞–π–ª —Å –ø–æ–¥—Å–∫–∞–∑–∫–æ–π

```bash
#!/bin/bash

mkdir -p ~/.config/systemd/user
cp gitlab-runner.service ~/.config/systemd/user/gitlab-runner.service

systemctl --user daemon-reload
systemctl --user start gitlab-runner
```

–ü–æ–ª–æ–∂–∏–º —Ñ–∞–π–ª –≤ –¥–æ–º–∞—à–Ω—é—é –¥–∏—Ä—Ä–µ–∫—Ç–æ—Ä–∏—é ~/.config/systemd/user.

`mkdir -p ~/.config/systemd/user`

`cp gitlab-runner.service ~/.config/systemd/user/gitlab-runner.service`

–ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–∏—Å:

`systemctl --user start gitlab-runner`

–ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–µ—Ä–≤–∏—Å –∑–∞–ø—É—Å—Ç–∏–ª—Å—è:

`systemctl --user status gitlab-runner`

```bash
‚óè gitlab-runner.service - gitlab-runner
     Loaded: loaded (/home/vagrant/.config/systemd/user/gitlab-runner.service; disabled; vendor preset:>
     Active: active (running) since Wed 2022-08-24 21:25:22 UTC; 10s ago
   Main PID: 41426 (gitlab-runner)
     CGroup: /user.slice/user-1000.slice/user@1000.service/gitlab-runner.service
             ‚îî‚îÄ41426 /usr/bin/gitlab-runner run --working-directory /home/vagrant/gitlab-runner

Aug 24 21:25:22 ci systemd[2192]: Started gitlab-runner.
Aug 24 21:25:22 ci gitlab-runner[41426]: Runtime platform                                    arch=amd64>
Aug 24 21:25:22 ci gitlab-runner[41426]: Starting multi-runner from /home/vagrant/.gitlab-runner/config>
Aug 24 21:25:22 ci gitlab-runner[41426]: WARNING: Running in user-mode.                    
Aug 24 21:25:22 ci gitlab-runner[41426]: WARNING: Use sudo for system-mode:                
Aug 24 21:25:22 ci gitlab-runner[41426]: WARNING: $ sudo gitlab-runner...                  
Aug 24 21:25:22 ci gitlab-runner[41426]:                                                   
Aug 24 21:25:22 ci gitlab-runner[41426]: Configuration loaded                                builds=0
Aug 24 21:25:22 ci gitlab-runner[41426]: listen_address not defined, metrics & debug endpoints disabled>
Aug 24 21:25:22 ci gitlab-runner[41426]: [session_server].listen_address not defined, session endpoints>
```

–í–∏–¥–∏–º, —á—Ç–æ Started gitlab-runner –∑–∞–ø—É—â–µ–Ω. –í—ã—Ö–æ–¥–∏–º `ctrl`+`C`. –ú–æ–∂–µ–º –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏:

`sudo journalctl -u gitlab-runner`

##### gitlab-ci

–ü–æ—Å–º–æ—Ç—Ä–∏–º, —á—Ç–æ –º—ã —Ö–æ—Ç–∏–º –¥–æ–±–∏—Ç—å—Å—è –æ—Ç –Ω–∞—à–µ–≥–æ CI (—Ñ–∞–π–ª .gitlab-ci.yml):

```yaml
build:
  stage: build
  script:
    - cd presentation/01-package-docker
    - make docker-build

cd:
  stage: deploy
  script:
    - cd presentation/01-package-docker
    - echo $DOCKER_PASSWORD | docker login --username json_key --password-stdin cr.yandex
    - make docker-push

ci:
  stage: deploy
  needs:
    - cd
  script:
    - kubectl -n shbr rollout restart 'deployment/shbr-echo'–ø–µ—Ä–≤—ã–π —ç—Ç–∞–ø —Å–±–æ—Ä–∫–∏ (build); –¥–ª—è —ç—Ç–æ–≥–æ –º—ã –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–∫—É 
```

- –ø–µ—Ä–≤—ã–π —ç—Ç–∞–ø —Å–±–æ—Ä–∫–∏ (build), –¥–ª—è —Å–±–æ—Ä–∫–∏ –Ω–∞–º –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä—Ä–µ–∫—Ç–æ—Ä–∏—é presentation/01-package-docker –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å docker-build;

- –≤—Ç–æ—Ä–æ–π —ç—Ç–∞–ø; –¥–∞–ª—å—à–µ –∫–∞–∂–¥—ã–π step —Å—Ç–∞—Ä—Ç—É–µ—Ç –∏–∑ –∫–æ—Ä–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ –ø—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ —á—Ç–æ-—Ç–æ –¥–µ–ª–∞—Ç—å –Ω–∞ –Ω—É–∂–Ω–æ –∑–∞–Ω–æ–≤–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –≤ –¥–∏—Ä—Ä–µ–∫—Ç–æ—Ä–∏—é, –∏–¥–µ–º –≤ presentation/01-package-docker, –ª–æ–≥–∏–Ω–∏–º—Å—è –≤ docker-registry –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç—É–¥–∞ –Ω–∞—à –æ–±—Ä–∞–∑.

- —Ç—Ä–µ—Ç–∏–π —ç—Ç–∞–ø - –∑–∞–ø—É—Å–∫–∞–µ–º —Ä–µ—Å—Ç–∞—Ä—Ç –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

##### DOCKER_PASSWORD

–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø—É—à–∏—Ç—å –≤–Ω—É—Ç—Ä—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω—É–∂–Ω–æ –∑–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è. –°–æ–∑–¥–∞–¥–∏–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é DOCKER_PASSWORD. –°–∞–º –ø–∞—Ä–æ–ª—å –Ω—É–∂–Ω–æ –∑–∞—Ä–∞–Ω–µ–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏ –ø–æ–ª–æ–∂–∏—Ç—å –≤ –∫–æ—Ä–µ–Ω—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è key.json

##### –ò–¢–û–ì–û

–£ –Ω–∞—Å –µ—Å—Ç—å —Ç—Ä–∏ —à–∞–≥–∞:

- —Å–±–æ—Ä–∫–∞ (build)
  
  –ù–∞ —ç—Ç–∞–ø–µ —Å–±–æ—Ä–∫–∏ –º—ã —Å–æ–±–∏—Ä–∞–µ–º –Ω–∞—à –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä. –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏ –æ–Ω–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –¥–æ–∫–µ—Ä-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –º—ã —Å–æ–±–∏—Ä–∞–µ–º.

- –¥–æ—Å—Ç–∞–≤–∫–∞ (deploy - cd)
  
  –ü–æ—Å–ª–µ —Å–±–æ—Ä–∫–µ –Ω–∞ —à–∞–≥–µ cd –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, –ø–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –µ–≥–æ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞–º –Ω—É–∂–Ω–æ –∑–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è. –≠—Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ.

- –¥–µ–ø–ª–æ–π (deploy - ci)
  
  –ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –º—ã –∑–∞–ø—É—à–∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º—ã —Å–æ–æ–±—â–∞–µ–º kubernetes, —á—Ç–æ–±—ã –æ–Ω –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª –Ω–∞—à –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç. Kubernetes –∑–∞ —Å—á–µ—Ç imagePullPolicy: "Always" - –ø–µ—Ä–µ—Å–∫–∞—á–∞–µ—Ç –Ω–∞—à –æ–±—Ä–∞–∑ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –º—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ –∑–∞–ø—É—à–∏–ª–∏ –≤—ã–µ–∑–∂–∞–µ—Ç –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω.
